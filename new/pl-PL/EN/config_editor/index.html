<!DOCTYPE html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
</head>

<script src="FileSaver.js"></script>
<script src="iso_8859_2.js"></script>
<script src="config_editor_strings_EN.js"></script>

<style>
  body {
    font-family: sans-serif;
    font-size: 14px;
    color: white;
    background-color: black;
  }
  
  h1 {
    font-size: 50px;
  }
  
  p {
    text-align: center;
    font-size: 25px;
  }
  
  th, td, table {
    border-style: solid;
    border-radius: 5px;
    text-align: center;
    border-color: white;
  }
  
  #main_table td {
    padding: 5px;
  }
  
  table {
    margin-left: auto;
    margin-right: auto;
  }
  
  .button {
    border: none;
    color: white;
    padding: 16px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    transition-duration: 0.4s;
    cursor: pointer;
  }
  
  #add_page_button, #remove_page_button, #add_parameter_button, #remove_parameter_button {
    background-color: #bd0808;
    margin-top: 5px;
    height:50px;
    width:50px;
    border-radius: 10px;
    font-weight: bold;
    font-size: 24px;
  }
  
  #select_page, #select_parameter {
    height: 50px;
    width: 100px;
    border-radius: 10px;
    text-align: center;
    appearance: none;
    font-weight: bold;
    font-size: 24px;
  }
  
  select {
    background-color: #c0c0c0;
  }
  
  input[type='number']{
    width: 80px;
  }
  
  input[type='checkbox']{
    accent-color: #bd0808;
  }
  
  input[type='text']{
    border-radius: 10px;
    background-color: white;
    text-align: center;
  }
  
  hr {
    height: 5px;
    color: white;
    background-color: white;
  }
  
  input[type="file"], input[type="button"] {
    display: none;
  }
  
  .file_button {
    display: none;
  }
  
  .custom-file-upload {
    border: 5px solid white;
    border-radius: 10px;
    display: inline-block;
    padding: 6px 12px;
    cursor: pointer;
    transition: 0.3s;
  }
  
  .custom-file-upload:hover {
    background-color: gray;
    color: white;
  }
</style>

<body onload='load_strings(), populate_usable_devices(), add_page()'>
  <hr>
  
  <h1 id='S_optional_step'></h1>
  <table style='border:none;width:100%;font-size:50px;padding:10px'>
    <tr>
      <td style='border:none'>
        <label id='S_edit_prev_config' class='custom-file-upload'>
          <input type='file' onchange='load_file(event)'/>
        </label>
      </td>
    </tr>
  </table>
  
  <hr>
  
  <h1 id='S_step_1'></h1>
  <table>
    <tr>
      <th id='S_settings' colspan=2></th>
    </tr>
    <tr>
      <td id='S_controls'></td>
      <td>
        <select id='select_control_scheme' onchange='change_setting_control_scheme(this.selectedIndex)'>
          <option id='S_select_up_down'></option>
          <option id='S_select_reset'></option>
        </select>
      </td>
    </tr>
  </table>
  
  <hr>
  
  <h1 id='S_step_2'></h1>
  <table>
    <tr>
      <th id='S_choose_tools'></th>
      <th id='S_configure_tools'></th>
    </tr>
    <tr>
      <td>
        <select id='select_tool' onchange='change_tool(this.selectedIndex)'>
          <option id='S_acceleration_timer'></option>
          <option id='S_oil_level_gauge'></option>
          <option id='S_engine_mileage'></option>
          <option id='S_openhaldex'></option>
        </select>
      </td>
      <td>
        <table style='border:none'>
          <tr>
            <td id='S_enabled'>
              <input type="checkbox" id='enable_tool_checkbox' onchange='enable_tool(this.checked)'>
            </td>
            <td style='border:none' id='tool_source_config_table_data'></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  
  <br>
  <hr>
  
  <h1 id='S_step_3'></h1>
  <table>
    <tr>
      <th id='S_choose_modules' colspan=2></th>
    </tr>
    <tr>
      <td>KWP</td>
      <td>UDS</td>
    </tr>
    <tr>
      <td>
        <select id='select_used_kwp_device_index' onchange='show_used_kwp_device()'>
          <option>1
          <option>2
          <option>3
          <option>4
          <option>5
        </select>
        <select id='select_used_kwp_device' onchange='save_used_kwp_device()'>
        </select>
      </td>
      <td>
        <select id='select_used_uds_device_index' onchange='show_used_uds_device()'>
          <option>1
          <option>2
          <option>3
          <option>4
          <option>5
        </select>
        <select id='select_used_uds_device' onchange='save_used_uds_device()'>
        </select>
      </td>
    </tr>
  </table>
  
  <br>
  <hr>
  
  <h1 id='S_step_4'></h1>
  <table id='main_table'>
    <tr>
      <th id='S_configure_ecu_data' colspan=2></th>
    </tr>
    <tr>
      <td>
        <table>
          <tr>
            <th id='S_pages' colspan=3></th>
          </tr>
          <tr>
            <td id='S_number'></td>
            <td id='S_title'></td>
            <td id='S_options'></td>
          </tr>
          <tr>
            <td>
              <select id='select_page' onchange='change_to_page(this.selectedIndex), change_to_parameter(0)'></select>
              <br>
              <button type='button' id='add_page_button' onclick=add_page()>+</button>
              <button type='button' id='remove_page_button' onclick=remove_page()>-</button>
            </td>
            <td>
              <input type='text' id='input_page_title' onchange='set_page_title(this)'></input>
            </td>
            <td>
              <input type="checkbox" id='aligned_units_checkbox' onchange='enable_aligned_units(this.checked)'></input>
              <label for="aligned_units_checkbox" id='S_aligned_units'></label>
              <br>
              <input type="checkbox" id='bar_at_bottom_checkbox' onchange='enable_bar_at_bottom(this.checked)'></input>
              <label for="bar_at_bottom_checkbox" id='S_bar_at_bottom'></label>
            </td>
          </tr>
        </table>
      </td>
      
      <td rowspan=2>
        <br>
        
        <table>
          <tr>
            <th id='S_parameter_source' colspan=100></th>
          </tr>
          <tr id='protocol_header_row'></tr>
          <tr id='protocol_data_row'></tr>
        </table>
        
        <br>
        
        <table>
          <tr>
            <th id='S_value_display' colspan=100></th>
          </tr>
          <tr id='display_header_row'></tr>
          <tr id='display_data_row'></tr>
        </table>
        
        <br>
        
        <table>
          <tr>
            <th id='S_value_warning' colspan=100></th>
          </tr>
          <tr id='warning_header_row'></tr>
          <tr id='warning_data_row'></tr>
        </table>
        
        <br>
        
        <table>
          <tr>
            <th id='S_graph_parameters' colspan=100></th>
          </tr>
          <tr>
            <th id='S_bottom'></th>
            <th id='S_top'></th>
            <th id='S_rate'></th>
          </tr>
          <tr>
            <td><input type='number' id='input_graph_bottom' onchange='set_graph_bottom(this)'></td>
            <td><input type='number' id='input_graph_top' onchange='set_graph_top(this)'></td>
            <td><input type='number' id='input_graph_rate' onchange='set_graph_rate(this)'></td>
          </tr>
        </table>
        
        <br>
      </td>
    </tr>
    
    <tr>
      <td>
        <table>
          <tr>
            <th id='S_parameters' colspan=3></th>
          </tr>
          <tr>
            <td id='S_number'></td>
            <td id='S_name'></td>
            <td id='S_units'></td>
          </tr>
          <tr>
            <td>
              <select id='select_parameter' onchange='change_to_parameter(this.selectedIndex)'></select>
              <br>
              <button type='button' id='add_parameter_button' onclick=add_parameter()>+</button>
              <button type='button' id='remove_parameter_button' onclick=remove_parameter()>-</button>
            </td>
            <td><input type="text" id='input_parameter_name' onchange='set_parameter_name(this)'></input></td>
            <td><input type="text" id='input_parameter_units' onchange='set_parameter_units(this)'></input></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  
  <br>
  <hr>
  
  <h1 id='S_step_5'></h1>
  <table style='border:none;width:100%;font-size:50px;padding:10px'>
    <tr>
      <td style='border:none'>
        <label id='S_download_config' class='custom-file-upload'>
          <input type='button' onclick='download_file()'/>
        </label>
      </td>
    </tr>
  </table>
  
  <hr>
</body>

<script>
  /*
    3.0.2
      -fixed "Offset" for "Mapped value", which was being parsed as Int instead of Float
      -values for "Mapped value" changed from Int16 to Float32
      -float values are read back from a previous configuration with 3 decimal places instead of 2
  */
  
  //Prevent leaving the page accidentally
  window.onbeforeunload = function() {
    return S_data_will_be_lost;
  };
  
  var setting_control_scheme = 0;
  
  //Tool objects
  var acceleration_timer_tool = {};
  var oil_level_checker_tool = {};
  var engine_mileage_tool = {};
  var openhaldex_tool = {};
  
  //Currently used modules
  var used_kwp_devices = [0, 0, 0, 0, 0];
  var used_uds_devices = [0, 0, 0, 0, 0];
  
  //Available modules
  var KWP_control_units = ["00 - " + S_not_used, "01 - Engine", "02 - Auto Trans", "04 - Steering Angle", "05 - Access/Start Authentication", "06 - Seat Memory Passenger", "07 - Control Head", "08 - Auto HVAC", "09 - Central Electrics", "0D - Slide Door, Left", "0E - Media Player 1", "0F - Digital Radio", "10 - Parking/Steering Assist", "11 - Engine II", "13 - Automatic Distance Regulation", "14 - Suspension Electrics", "15 - Airbags", "16 - Steering Wheel", "17 - Instruments", "18 - Auxiliary Heating", "19 - CAN Gateway", "1B - Active steering", "1C - Position Sensing", "1D - Driver Identification", "1E - Media Player 2", "1F - Satellite Tuner", "20 - High Beam Assist", "21 - Engine III / Battery 2", "22 - AWD", "23 - Brake Booster", "25 - Immobilizer", "26 - Auto Roof", "27 - Control Head, Rear", "28 - HVAC, Rear", "29 - Left Light", "2D - Intercom", "2E - Media Player 3", "2F - Digital TV", "30 - Special Function II", "32 - Differential Locks", "34 - Level Control", "36 - Seat Memory, Driver", "37 - Navigation", "38 - Roof Electrics", "39 - Right Light", "3C - Lane Change", "3D - Special Function", "3E - Media Player 4", "42 - Door Electrics, Driver", "44 - Steering Assist", "46 - Central Convenience", "47 - Sound System", "48 - Seat, Rear, Driver Side", "4B - Multifunction Module", "4C - Tire Pressure II", "4E - Control Head Right Rear", "4F - Central Electrics II", "52 - Door Electrics, Passenger", "53 - Parking Brake", "55 - Headlight Range", "56 - Radio", "57 - TV Tuner", "59 - Tow Protection", "5B - Seat, Rear, Passenger Side", "5C - Lane Maintaining", "5D - Operations", "5E - Control Head Left Rear", "5F - Infotainment Electrics", "61 - Battery Regulation", "62 - Door, Rear Left", "63 - Entry Assist, Driver", "65 - Tire Pressure", "66 - Seat, Rear", "67 - Voice Control", "68 - Wiper Electrics", "69 - Trailer", "6B - Aerodynamics", "6C - Back-up Camera", "6D - Trunk Electrics", "6E - Control Head Roof", "6F - Central Convenience II", "71 - Battery Charger", "72 - Door, Rear Right", "73 - Entry Assist, Passenger", "74 - Chassis Control", "75 - Telematics", "76 - Parking Assist", "77 - Telephone", "78 - Slide Door, Right", "7D - Auxiliary Heating", "7E - Control Head Dash", "7F - Infotainment Electrics II"];    
  var UDS_control_units = ["00 - " + S_not_used, "01 - Engine", "02 - Auto Trans", "04 - Steering Angle", "05 - Access/Start Authentication", "06 - Seat Memory Passenger", "08 - Auto HVAC", "09 - Central Electrics", "0C - Rear Axle Steering 2", "0E - Media Player 1", "10 - Parking/Steering Assist", "11 - Engine II", "13 - Automatic Distance Regulation", "14 - Suspension Electrics", "15 - Airbags", "16 - Steering Wheel", "17 - Instruments", "18 - Auxiliary Heating", "19 - CAN Gateway", "1B - Active steering", "20 - High Beam Assist", "21 - Engine III / Battery 2", "22 - AWD", "23 - Brake Booster", "25 - Immobilizer", "26 - Auto Roof", "28 - HVAC, Rear", "2B - Steering Column Lock", "30 - Special Function II", "32 - Differential Locks", "34 - Level Control", "36 - Seat Memory, Driver", "37 - Navigation", "3A - Special Vehicle Assist", "3B - Sensor Electrics", "3C - Lane Change", "3D - Special Function", "40 - AC Compressor", "42 - Door Electrics, Driver", "44 - Steering Assist", "47 - Sound System", "51 - Electric Drive", "52 - Door Electrics, Passenger", "53 - Parking Brake", "55 - Headlight Range", "57 - TV Tuner", "5F - Infotainment Electrics", "60 - Trip Recorder", "65 - Tire Pressure", "69 - Trailer", "6B - Aerodynamics", "6C - Back-up Camera", "6D - Trunk Electrics", "6F - Central Convenience II", "71 - Battery Charger", "75 - Telematics", "76 - Parking Assist", "77 - Telephone", "7F - Infotainment Electrics II"];
  
  //Array containing pages' configurations
  var page_array = [];
  
  function load_strings() {
    document.title = S_page_title;
    
    for (const str in HTML_strings) {
      var elms = document.querySelectorAll("#" + str);
      for(var i = 0; i < elms.length; i++) {
        elms[i].insertAdjacentHTML("beforeend", HTML_strings[str]);
      }
    }
    
    document.getElementById('input_page_title').placeholder = S_page_title_placeholder;
    document.getElementById('input_parameter_name').placeholder = S_parameter_name_placeholder;
    document.getElementById('input_parameter_units').placeholder = S_measurement_units_placeholder;
  }
  
  //Called at body onload to fill the used modules drop-downs
  function populate_usable_devices() {
    //Uncheck the "Enabled" checkbox for tools
    var enable_tool_checkbox = document.getElementById('enable_tool_checkbox');
    enable_tool_checkbox.checked = false;
    
    //Populate the devices for both protocols
    populate_usable_kwp_devices();
    populate_usable_uds_devices();
  }
  
  function change_setting_control_scheme(scheme) {
    setting_control_scheme = scheme;
  }
  
  function change_global_settings() {
    var select_control_scheme = document.getElementById('select_control_scheme');
    select_control_scheme.selectedIndex = setting_control_scheme & 1;
  }
  
  //Update the tool configuration part when selecting a tool from the drop-down
  function change_tool(tool) {
    //The function is also called when loading a file; as precaution, set the selected index for the drop-down
    var select_tool = document.getElementById('select_tool');
    select_tool.selectedIndex = tool;
    
    //Update the tool configuration part based on the selected tool
    switch (tool) {
      case 0: //Acceleration timer
        //Set the checkbox' checked state based on the tool's enabled state
        var enable_tool_checkbox = document.getElementById('enable_tool_checkbox');
        enable_tool_checkbox.checked = acceleration_timer_tool.enabled;
        
        //If checked, add the config table and update it
        if (enable_tool_checkbox.checked) {
          create_tool_source_config_table(tool);
          show_acceleration_timer_tool_source();
        }
        //Otherwise, delete the config table
        else {
          delete_tool_source_config_table();
        }
        break;
      
      case 1: //Oil level checker
        //Set the checkbox' checked state based on the tool's enabled state
        var enable_tool_checkbox = document.getElementById('enable_tool_checkbox');
        enable_tool_checkbox.checked = oil_level_checker_tool.enabled;
        
        //If checked, add the config table and update it
        if (enable_tool_checkbox.checked) {
          create_tool_source_config_table(tool);
          show_oil_level_checker_tool_source();
        }
        //Otherwise, delete the config table
        else {
          delete_tool_source_config_table();
        }
        break;
      
      case 2: //Engine mileage
        //Set the checkbox' checked state based on the tool's enabled state
        var enable_tool_checkbox = document.getElementById('enable_tool_checkbox');
        enable_tool_checkbox.checked = engine_mileage_tool.enabled;
        
        //If checked, add the config table and update it
        if (enable_tool_checkbox.checked) {
          create_tool_source_config_table(tool);
          show_engine_mileage_tool_source();
        }
        //Otherwise, delete the config table
        else {
          delete_tool_source_config_table();
        }
        break;
      
      case 3: //OpenHaldex
        //Set the checkbox' checked state based on the tool's enabled state
        var enable_tool_checkbox = document.getElementById('enable_tool_checkbox');
        enable_tool_checkbox.checked = openhaldex_tool.enabled;
        
        delete_tool_source_config_table();
        break;
    }
  }
  
  //Add the configuration table for a tool
  function create_tool_source_config_table(tool) {
    //Add the table corresponding to the given tool
    var tool_source_config_table_data = document.getElementById('tool_source_config_table_data');
    switch (tool) {
      case 0: //Acceleration timer
        tool_source_config_table_data.innerHTML =
          '<table style="border:none">' +
          '<tr><th colspan=100>' + S_speed_source + ' (km/h)</th></tr>' +
          '<tr id="acceleration_tool_source_header_row"></tr>' +
          '<tr id="acceleration_tool_source_data_row"></tr>' +
          '</table>';
        break;
      
      case 1: //Oil level checker
        tool_source_config_table_data.innerHTML =
          '<table style="border:none">' +
          '<tr><th colspan=100>' + S_oil_level_temperature_source + '</th></tr>' +
          '<tr id="oil_level_checker_tool_source_header_row"></tr>' +
          '<tr id="oil_level_checker_tool_source_data_row"></tr>' +
          '</table>' +
          '<table style="border:none">' +
          '<tr><th colspan=100>' + S_oil_level + ' (mm)</th></tr>' +
          '<tr id="oil_level_source_header_row"></tr>' +
          '<tr id="oil_level_source_data_row"></tr>' +
          '</table>' +
          '<table style="border:none">' +
          '<tr><th colspan=100>' + S_oil_temperature + ' (Â°C)</th></tr>' +
          '<tr id="oil_temperature_source_header_row"></tr>' +
          '<tr id="oil_temperature_source_data_row"></tr>' +
          '</table>' +
          '<table style="border:none">' +
          '<tr><th colspan=100>' + S_oil_level_values + '</th></tr>' +
          '<tr id="oil_level_checker_tool_range_header_row"></tr>' +
          '<tr id="oil_level_checker_tool_range_data_row"></tr>' +
          '</table>';
        break;
      
      case 2: //Engine mileage
        tool_source_config_table_data.innerHTML =
          '<table style="border:none">' +
          '<tr><th colspan=100>' + S_mileage_source + ' (km)</th></tr>' +
          '<tr id="engine_mileage_tool_source_header_row"></tr>' +
          '<tr id="engine_mileage_tool_source_data_row"></tr>' +
          '</table>' +
          '<table style="border:none">' +
          '<tr><th>' + S_mileage_offset + '</th></tr>' +
          '<tr><td><input type="number" id="input_mileage_offset" onchange="set_mileage_offset(this)"></td></tr>' +
          '</table>';
        break;
    }
  }
  
  //Delete the tool configuration table
  function delete_tool_source_config_table() {
    var tool_source_config_table_data = document.getElementById('tool_source_config_table_data');
    tool_source_config_table_data.innerHTML = '';
  }
  
  //Called when checking/unchecking the "Enabled" checkbox for a tool
  function enable_tool(state) {
    //If enabling a tool, create its config table
    var select_tool = document.getElementById('select_tool');
    if (state) {
      create_tool_source_config_table(select_tool.selectedIndex);
    }
    //Otherwise, delete its config table
    else {
      delete_tool_source_config_table();
    }
    
    //Show the tool config part corresponding to the selected tool
    switch (select_tool.selectedIndex) {
      case 0:
        //If the tool is enabled, update its config table
        if (state) {
          change_acceleration_timer_tool_source_protocol(0);
        }
        //Otherwise, disable the tool
        else {
          acceleration_timer_tool = {
            enabled: 0
          };
        }
        break;
      
      case 1:
        //If the tool is enabled, update its config table
        if (state) {
          change_oil_level_checker_tool_source_protocol(0);
        }
        //Otherwise, disable the tool
        else {
          oil_level_checker_tool = {
            enabled: 0
          };
        }
        break;
      
      case 2:
        //If the tool is enabled, update its config table
        if (state) {
          change_engine_mileage_tool_source_protocol(0);
        }
        //Otherwise, disable the tool
        else {
          engine_mileage_tool = {
            enabled: 0
          };
        }
        break;
      
      case 3:
        if (state)
        {
          openhaldex_tool = {
            enabled: 1
          };
        }
        else
        {
          openhaldex_tool = {
            enabled: 0
          };
        }
        break;
    }
  }
  
  function change_acceleration_timer_tool_source_protocol(protocol) {
    switch (protocol) {
      case 0:
        acceleration_timer_tool = {
          enabled: 1,
          protocol: 0,
          module: 0,
          block: 1,
          index: 1
        };
        break;
      
      case 1:
        acceleration_timer_tool = {
          enabled: 1,
          protocol: 1,
          module: 0,
          identifier: 0,
          endianness: 0,
          size: 1,
          sign: 0,
          factor: 1,
          divisor: 1,
          offset: 0
        };
        break;
    }
    
    show_acceleration_timer_tool_source();
  }
  
  function show_acceleration_timer_tool_source() {
    var protocol = acceleration_timer_tool.protocol;
    
    var acceleration_tool_source_header_row = document.getElementById('acceleration_tool_source_header_row');
    var acceleration_tool_source_data_row = document.getElementById('acceleration_tool_source_data_row');
    
    switch (protocol) {
      case 0:
        acceleration_tool_source_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>' + S_block + '</th>' + 
          '<th>' + S_index + '</th>';
        
        acceleration_tool_source_data_row.innerHTML =
          '<td>' + 
          '<select id="select_speed_protocol" onchange=change_acceleration_timer_tool_source_protocol(this.selectedIndex)>' +
          '<option selected>KWP</option>' +
          '<option>UDS</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_speed_device" onchange="change_speed_device(this)">' +
          '</select>' +
          '</td>' +
          '<td><select id="select_speed_kwp_block" onchange="set_speed_kwp_block(this)"></select></td>' +
          '<td><select id="select_speed_kwp_index" onchange="set_speed_kwp_index(this)"></select></td>';
        
        //Populate the device drop-down
        var select_speed_device = document.getElementById('select_speed_device');
        for (i = 0; i < KWP_control_units.length; i++) {
          select_speed_device.options.add(new Option(KWP_control_units[i]));
        }
        
        //Search for the currently stored module
        var module_to_search_for = acceleration_timer_tool.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of KWP modules
          var found = false;
          for(i = 0; i < KWP_control_units.length; i++) {
            if (module_to_search_for === parseInt(KWP_control_units[i].substring(0, 2), 16)) {
              //Select the currently stored module
              select_speed_device.selectedIndex = i;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_speed_device.selectedIndex = 0;
            acceleration_timer_tool.module = 0;
          }
        }
        else {
          select_speed_device.selectedIndex = 0;
        }
        
        //Populate the block drop-down
        var select_speed_kwp_block = document.getElementById('select_speed_kwp_block');
        for (i = 1; i <= 254; i++) {
          select_speed_kwp_block.options.add(new Option(i));
        }
        
        //Populate the index drop-down
        var select_speed_kwp_index = document.getElementById('select_speed_kwp_index');
        for (i = 1; i <= 4; i++) {
          select_speed_kwp_index.options.add(new Option(i));
        }
        
        //Select the block and index according to what is stored
        select_speed_kwp_block.selectedIndex = acceleration_timer_tool.block - 1;
        select_speed_kwp_index.selectedIndex = acceleration_timer_tool.index - 1;
        break;
      
      case 1:
        acceleration_tool_source_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>ID</th>' + 
          '<th>E</th>' +
          '<th>SZ</th>' +
          '<th>SG</th>' +
          '<th>F</th>' +
          '<th>D</th>' +
          '<th>O</th>';
        
        acceleration_tool_source_data_row.innerHTML =
          '<td>' + 
          '<select id="select_speed_protocol" onchange=change_acceleration_timer_tool_source_protocol(this.selectedIndex)>' +
          '<option>KWP</option>' +
          '<option selected>UDS</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_speed_device" onchange="change_speed_device(this)">' +
          '</select>' +
          '</td>' +
          '<td><input type="number" id="input_speed_uds_identifier" onchange="set_speed_uds_identifier(this)"></input></td>' +
          '<td><select id="select_speed_uds_endianness" onchange="set_speed_uds_endianness(this)"><option>Little<option>Big</select></td>' +
          '<td><select id="select_speed_uds_data_size" onchange="set_speed_uds_size(this)"><option>1<option>2<option>4</select></td>' +
          '<td><select id="select_speed_uds_data_sign" onchange="set_speed_uds_sign(this)"><option>Unsigned<option>Signed</select></td>' +
          '<td><input type="number" id="input_speed_uds_factor" onchange="set_speed_uds_factor(this)"></input></td>' +
          '<td><input type="number" id="input_speed_uds_divisor" onchange="set_speed_uds_divisor(this)"></input></td>' +
          '<td><input type="number" id="input_speed_uds_offset" onchange="set_speed_uds_offset(this)"></input></td>';
        
        //Populate the device drop-down
        var select_speed_device = document.getElementById('select_speed_device');
        for (i = 0; i < UDS_control_units.length; i++) {
          select_speed_device.options.add(new Option(UDS_control_units[i]));
        }
        
        //Search for the currently stored module
        var module_to_search_for = acceleration_timer_tool.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of KWP modules
          var found = false;
          for(i = 0; i < UDS_control_units.length; i++) {
            if (module_to_search_for === parseInt(UDS_control_units[i].substring(0, 2), 16)) {
              //Select the currently stored module
              select_speed_device.selectedIndex = i;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_speed_device.selectedIndex = 0;
            acceleration_timer_tool.module = 0;
          }
        }
        else {
          select_speed_device.selectedIndex = 0;
        }
        
        var input_speed_uds_identifier = document.getElementById('input_speed_uds_identifier');
        var select_speed_uds_endianness = document.getElementById('select_speed_uds_endianness');
        var select_speed_uds_data_size = document.getElementById('select_speed_uds_data_size');
        var select_speed_uds_data_sign = document.getElementById('select_speed_uds_data_sign');
        var input_speed_uds_factor = document.getElementById('input_speed_uds_factor');
        var input_speed_uds_divisor = document.getElementById('input_speed_uds_divisor');
        var input_speed_uds_offset = document.getElementById('input_speed_uds_offset');
        
        input_speed_uds_identifier.value = acceleration_timer_tool.identifier;
        select_speed_uds_endianness.selectedIndex = acceleration_timer_tool.endianness;
        select_speed_uds_data_size.value = acceleration_timer_tool.size;
        select_speed_uds_data_sign.selectedIndex = acceleration_timer_tool.sign;
        input_speed_uds_factor.value = acceleration_timer_tool.factor;
        input_speed_uds_divisor.value = acceleration_timer_tool.divisor;
        input_speed_uds_offset.value = acceleration_timer_tool.offset;
        break;
    }
  }
  
  function change_oil_level_checker_tool_source_protocol(protocol) {
    switch (protocol) {
      case 0:
        oil_level_checker_tool = {
          enabled: 1,
          min: 0,
          max: 0,
          protocol: 0,
          module: 0,
          block: 1,
          index: 1,
          block_temp: 1,
          index_temp: 1
        };
        break;
      
      case 1:
        oil_level_checker_tool = {
          enabled: 1,
          min: 0,
          max: 0,
          protocol: 1,
          module: 0,
          identifier: 0,
          endianness: 0,
          size: 1,
          sign: 0,
          factor: 1,
          divisor: 1,
          offset: 0,
          identifier_temp: 0,
          endianness_temp: 0,
          size_temp: 1,
          sign_temp: 0,
          factor_temp: 1,
          divisor_temp: 1,
          offset_temp: 0
        };
        break;
    }
    
    show_oil_level_checker_tool_source();
  }
  
  function show_oil_level_checker_tool_source() {
    var protocol = oil_level_checker_tool.protocol;
    
    var oil_level_checker_tool_range_header_row = document.getElementById('oil_level_checker_tool_range_header_row');
    var oil_level_checker_tool_range_data_row = document.getElementById('oil_level_checker_tool_range_data_row');
    
    oil_level_checker_tool_range_header_row.innerHTML =
      '<th>' + S_min + '</th>' +
      '<th>' + S_max + '</th>';
    
    oil_level_checker_tool_range_data_row.innerHTML =
      '<td>' + 
      '<input type="number" id="input_oil_level_min" onchange="set_oil_level_min(this)">' +
      '</td>' +
      '<td>' + 
      '<input type="number" id="input_oil_level_max" onchange="set_oil_level_max(this)">' +
      '</td>';
    
    var input_oil_level_min = document.getElementById('input_oil_level_min');
    input_oil_level_min.value = oil_level_checker_tool.min;
    var input_oil_level_max = document.getElementById('input_oil_level_max');
    input_oil_level_max.value = oil_level_checker_tool.max;
    
    var oil_level_checker_tool_source_header_row = document.getElementById('oil_level_checker_tool_source_header_row');
    var oil_level_checker_tool_source_data_row = document.getElementById('oil_level_checker_tool_source_data_row');
    
    var oil_level_source_header_row = document.getElementById('oil_level_source_header_row');
    var oil_level_source_data_row = document.getElementById('oil_level_source_data_row');
    
    var oil_temperature_source_header_row = document.getElementById('oil_temperature_source_header_row');
    var oil_temperature_source_data_row = document.getElementById('oil_temperature_source_data_row');
    
    switch (protocol) {
      case 0:
        oil_level_checker_tool_source_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>';
        
        oil_level_checker_tool_source_data_row.innerHTML =
          '<td>' + 
          '<select id="select_oil_level_protocol" onchange=change_oil_level_checker_tool_source_protocol(this.selectedIndex)>' +
          '<option selected>KWP</option>' +
          '<option>UDS</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_oil_level_device" onchange="change_oil_level_device(this)">' +
          '</select>' +
          '</td>';
        
        oil_level_source_header_row.innerHTML =
          '<th>' + S_block + '</th>' + 
          '<th>' + S_index + '</th>';
        
        oil_level_source_data_row.innerHTML =
          '<td><select id="select_oil_level_kwp_block" onchange="set_oil_level_kwp_block(this)"></select></td>' +
          '<td><select id="select_oil_level_kwp_index" onchange="set_oil_level_kwp_index(this)"></select></td>';
        
        oil_temperature_source_header_row.innerHTML =
          '<th>' + S_block + '</th>' + 
          '<th>' + S_index + '</th>';
        
        oil_temperature_source_data_row.innerHTML =
          '<td><select id="select_oil_temperature_kwp_block" onchange="set_oil_temperature_kwp_block(this)"></select></td>' +
          '<td><select id="select_oil_temperature_kwp_index" onchange="set_oil_temperature_kwp_index(this)"></select></td>';
        
        //Populate the device drop-down
        var select_oil_level_device = document.getElementById('select_oil_level_device');
        for (i = 0; i < KWP_control_units.length; i++) {
          select_oil_level_device.options.add(new Option(KWP_control_units[i]));
        }
        
        //Search for the currently stored module
        var module_to_search_for = oil_level_checker_tool.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of KWP modules
          var found = false;
          for(i = 0; i < KWP_control_units.length; i++) {
            if (module_to_search_for === parseInt(KWP_control_units[i].substring(0, 2), 16)) {
              //Select the currently stored module
              select_oil_level_device.selectedIndex = i;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_oil_level_device.selectedIndex = 0;
            oil_level_checker_tool.module = 0;
          }
        }
        else {
          select_oil_level_device.selectedIndex = 0;
        }
        
        //Populate the block drop-down
        var select_oil_level_kwp_block = document.getElementById('select_oil_level_kwp_block');
        for (i = 1; i <= 254; i++) {
          select_oil_level_kwp_block.options.add(new Option(i));
        }
        
        //Populate the index drop-down
        var select_oil_level_kwp_index = document.getElementById('select_oil_level_kwp_index');
        for (i = 1; i <= 4; i++) {
          select_oil_level_kwp_index.options.add(new Option(i));
        }
        
        //Populate the block drop-down
        var select_oil_temperature_kwp_block = document.getElementById('select_oil_temperature_kwp_block');
        for (i = 1; i <= 254; i++) {
          select_oil_temperature_kwp_block.options.add(new Option(i));
        }
        
        //Populate the index drop-down
        var select_oil_temperature_kwp_index = document.getElementById('select_oil_temperature_kwp_index');
        for (i = 1; i <= 4; i++) {
          select_oil_temperature_kwp_index.options.add(new Option(i));
        }
        
        //Select the block and index according to what is stored
        select_oil_level_kwp_block.selectedIndex = oil_level_checker_tool.block - 1;
        select_oil_level_kwp_index.selectedIndex = oil_level_checker_tool.index - 1;
        select_oil_temperature_kwp_block.selectedIndex = oil_level_checker_tool.block_temp - 1;
        select_oil_temperature_kwp_index.selectedIndex = oil_level_checker_tool.index_temp - 1;
        break;
      
      case 1:
        oil_level_checker_tool_source_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>';
        
        oil_level_checker_tool_source_data_row.innerHTML =
          '<td>' + 
          '<select id="select_oil_level_protocol" onchange=change_oil_level_checker_tool_source_protocol(this.selectedIndex)>' +
          '<option>KWP</option>' +
          '<option selected>UDS</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_oil_level_device" onchange="change_oil_level_device(this)">' +
          '</select>' +
          '</td>';
        
        oil_level_source_header_row.innerHTML =
          '<th>ID</th>' + 
          '<th>E</th>' +
          '<th>SZ</th>' +
          '<th>SG</th>' +
          '<th>F</th>' +
          '<th>D</th>' +
          '<th>O</th>';
        
        oil_level_source_data_row.innerHTML =
          '<td><input type="number" id="input_oil_level_uds_identifier" onchange="set_oil_level_uds_identifier(this)"></input></td>' +
          '<td><select id="select_oil_level_uds_endianness" onchange="set_oil_level_uds_endianness(this)"><option>Little<option>Big</select></td>' +
          '<td><select id="select_oil_level_uds_data_size" onchange="set_oil_level_uds_size(this)"><option>1<option>2<option>4</select></td>' +
          '<td><select id="select_oil_level_uds_data_sign" onchange="set_oil_level_uds_sign(this)"><option>Unsigned<option>Signed</select></td>' +
          '<td><input type="number" id="input_oil_level_uds_factor" onchange="set_oil_level_uds_factor(this)"></input></td>' +
          '<td><input type="number" id="input_oil_level_uds_divisor" onchange="set_oil_level_uds_divisor(this)"></input></td>' +
          '<td><input type="number" id="input_oil_level_uds_offset" onchange="set_oil_level_uds_offset(this)"></input></td>';
        
        oil_temperature_source_header_row.innerHTML =
          '<th>ID</th>' + 
          '<th>E</th>' +
          '<th>SZ</th>' +
          '<th>SG</th>' +
          '<th>F</th>' +
          '<th>D</th>' +
          '<th>O</th>';
        
        oil_temperature_source_data_row.innerHTML =
          '<td><input type="number" id="input_oil_temperature_uds_identifier" onchange="set_oil_temperature_uds_identifier(this)"></input></td>' +
          '<td><select id="select_oil_temperature_uds_endianness" onchange="set_oil_temperature_uds_endianness(this)"><option>Little<option>Big</select></td>' +
          '<td><select id="select_oil_temperature_uds_data_size" onchange="set_oil_temperature_uds_size(this)"><option>1<option>2<option>4</select></td>' +
          '<td><select id="select_oil_temperature_uds_data_sign" onchange="set_oil_temperature_uds_sign(this)"><option>Unsigned<option>Signed</select></td>' +
          '<td><input type="number" id="input_oil_temperature_uds_factor" onchange="set_oil_temperature_uds_factor(this)"></input></td>' +
          '<td><input type="number" id="input_oil_temperature_uds_divisor" onchange="set_oil_temperature_uds_divisor(this)"></input></td>' +
          '<td><input type="number" id="input_oil_temperature_uds_offset" onchange="set_oil_temperature_uds_offset(this)"></input></td>';
        
        //Populate the device drop-down
        var select_oil_level_device = document.getElementById('select_oil_level_device');
        for (i = 0; i < UDS_control_units.length; i++) {
          select_oil_level_device.options.add(new Option(UDS_control_units[i]));
        }
        
        //Search for the currently stored module
        var module_to_search_for = oil_level_checker_tool.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of KWP modules
          var found = false;
          for(i = 0; i < UDS_control_units.length; i++) {
            if (module_to_search_for === parseInt(UDS_control_units[i].substring(0, 2), 16)) {
              //Select the currently stored module
              select_oil_level_device.selectedIndex = i;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_oil_level_device.selectedIndex = 0;
            oil_level_checker_tool.module = 0;
          }
        }
        else {
          select_oil_level_device.selectedIndex = 0;
        }
        
        var input_oil_level_uds_identifier = document.getElementById('input_oil_level_uds_identifier');
        var select_oil_level_uds_endianness = document.getElementById('select_oil_level_uds_endianness');
        var select_oil_level_uds_data_size = document.getElementById('select_oil_level_uds_data_size');
        var select_oil_level_uds_data_sign = document.getElementById('select_oil_level_uds_data_sign');
        var input_oil_level_uds_factor = document.getElementById('input_oil_level_uds_factor');
        var input_oil_level_uds_divisor = document.getElementById('input_oil_level_uds_divisor');
        var input_oil_level_uds_offset = document.getElementById('input_oil_level_uds_offset');
        
        input_oil_level_uds_identifier.value = oil_level_checker_tool.identifier;
        select_oil_level_uds_endianness.selectedIndex = oil_level_checker_tool.endianness;
        select_oil_level_uds_data_size.value = oil_level_checker_tool.size;
        select_oil_level_uds_data_sign.selectedIndex = oil_level_checker_tool.sign;
        input_oil_level_uds_factor.value = oil_level_checker_tool.factor;
        input_oil_level_uds_divisor.value = oil_level_checker_tool.divisor;
        input_oil_level_uds_offset.value = oil_level_checker_tool.offset;
        
        var input_oil_temperature_uds_identifier = document.getElementById('input_oil_temperature_uds_identifier');
        var select_oil_temperature_uds_endianness = document.getElementById('select_oil_temperature_uds_endianness');
        var select_oil_temperature_uds_data_size = document.getElementById('select_oil_temperature_uds_data_size');
        var select_oil_temperature_uds_data_sign = document.getElementById('select_oil_temperature_uds_data_sign');
        var input_oil_temperature_uds_factor = document.getElementById('input_oil_temperature_uds_factor');
        var input_oil_temperature_uds_divisor = document.getElementById('input_oil_temperature_uds_divisor');
        var input_oil_temperature_uds_offset = document.getElementById('input_oil_temperature_uds_offset');
        
        input_oil_temperature_uds_identifier.value = oil_level_checker_tool.identifier_temp;
        select_oil_temperature_uds_endianness.selectedIndex = oil_level_checker_tool.endianness_temp;
        select_oil_temperature_uds_data_size.value = oil_level_checker_tool.size_temp;
        select_oil_temperature_uds_data_sign.selectedIndex = oil_level_checker_tool.sign_temp;
        input_oil_temperature_uds_factor.value = oil_level_checker_tool.factor_temp;
        input_oil_temperature_uds_divisor.value = oil_level_checker_tool.divisor_temp;
        input_oil_temperature_uds_offset.value = oil_level_checker_tool.offset_temp;
        break;
    }
  }
  
  function change_engine_mileage_tool_source_protocol(protocol) {
    switch (protocol) {
      case 0:
        engine_mileage_tool = {
          enabled: 1,
          km_offset: 0,
          protocol: 0,
          module: 0,
          block: 1,
          index: 1
        };
        break;
      
      case 1:
        engine_mileage_tool = {
          enabled: 1,
          km_offset: 0,
          protocol: 1,
          module: 0,
          identifier: 0,
          endianness: 0,
          size: 1,
          sign: 0,
          factor: 1,
          divisor: 1,
          offset: 0
        };
        break;
    }
    
    show_engine_mileage_tool_source();
  }
  
  function show_engine_mileage_tool_source() {
    var protocol = engine_mileage_tool.protocol;
    
    var input_mileage_offset = document.getElementById('input_mileage_offset');
    input_mileage_offset.value = engine_mileage_tool.km_offset;
    
    var engine_mileage_tool_source_header_row = document.getElementById('engine_mileage_tool_source_header_row');
    var engine_mileage_tool_source_data_row = document.getElementById('engine_mileage_tool_source_data_row');
    
    switch (protocol) {
      case 0:
        engine_mileage_tool_source_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>' + S_block + '</th>' + 
          '<th>' + S_index + '</th>';
        
        engine_mileage_tool_source_data_row.innerHTML =
          '<td>' + 
          '<select id="select_mileage_protocol" onchange=change_engine_mileage_tool_source_protocol(this.selectedIndex)>' +
          '<option selected>KWP</option>' +
          '<option>UDS</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_mileage_device" onchange="change_mileage_device(this)">' +
          '</select>' +
          '</td>' +
          '<td><select id="select_mileage_kwp_block" onchange="set_mileage_kwp_block(this)"></select></td>' +
          '<td><select id="select_mileage_kwp_index" onchange="set_mileage_kwp_index(this)"></select></td>';
        
        //Populate the device drop-down
        var select_mileage_device = document.getElementById('select_mileage_device');
        for (i = 0; i < KWP_control_units.length; i++) {
          select_mileage_device.options.add(new Option(KWP_control_units[i]));
        }
        
        //Search for the currently stored module
        var module_to_search_for = engine_mileage_tool.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of KWP modules
          var found = false;
          for(i = 0; i < KWP_control_units.length; i++) {
            if (module_to_search_for === parseInt(KWP_control_units[i].substring(0, 2), 16)) {
              //Select the currently stored module
              select_mileage_device.selectedIndex = i;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_mileage_device.selectedIndex = 0;
            engine_mileage_tool.module = 0;
          }
        }
        else {
          select_mileage_device.selectedIndex = 0;
        }
        
        //Populate the block drop-down
        var select_mileage_kwp_block = document.getElementById('select_mileage_kwp_block');
        for (i = 1; i <= 254; i++) {
          select_mileage_kwp_block.options.add(new Option(i));
        }
        
        //Populate the index drop-down
        var select_mileage_kwp_index = document.getElementById('select_mileage_kwp_index');
        for (i = 1; i <= 4; i++) {
          select_mileage_kwp_index.options.add(new Option(i));
        }
        
        //Select the block and index according to what is stored
        select_mileage_kwp_block.selectedIndex = engine_mileage_tool.block - 1;
        select_mileage_kwp_index.selectedIndex = engine_mileage_tool.index - 1;
        break;
      
      case 1:
        engine_mileage_tool_source_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>ID</th>' + 
          '<th>E</th>' +
          '<th>SZ</th>' +
          '<th>SG</th>' +
          '<th>F</th>' +
          '<th>D</th>' +
          '<th>O</th>';
        
        engine_mileage_tool_source_data_row.innerHTML =
          '<td>' + 
          '<select id="select_mileage_protocol" onchange=change_engine_mileage_tool_source_protocol(this.selectedIndex)>' +
          '<option>KWP</option>' +
          '<option selected>UDS</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_mileage_device" onchange="change_mileage_device(this)">' +
          '</select>' +
          '</td>' +
          '<td><input type="number" id="input_mileage_uds_identifier" onchange="set_mileage_uds_identifier(this)"></input></td>' +
          '<td><select id="select_mileage_uds_endianness" onchange="set_mileage_uds_endianness(this)"><option>Little<option>Big</select></td>' +
          '<td><select id="select_mileage_uds_data_size" onchange="set_mileage_uds_size(this)"><option>1<option>2<option>4</select></td>' +
          '<td><select id="select_mileage_uds_data_sign" onchange="set_mileage_uds_sign(this)"><option>Unsigned<option>Signed</select></td>' +
          '<td><input type="number" id="input_mileage_uds_factor" onchange="set_mileage_uds_factor(this)"></input></td>' +
          '<td><input type="number" id="input_mileage_uds_divisor" onchange="set_mileage_uds_divisor(this)"></input></td>' +
          '<td><input type="number" id="input_mileage_uds_offset" onchange="set_mileage_uds_offset(this)"></input></td>';
        
        //Populate the device drop-down
        var select_mileage_device = document.getElementById('select_mileage_device');
        for (i = 0; i < UDS_control_units.length; i++) {
          select_mileage_device.options.add(new Option(UDS_control_units[i]));
        }
        
        //Search for the currently stored module
        var module_to_search_for = engine_mileage_tool.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of KWP modules
          var found = false;
          for(i = 0; i < UDS_control_units.length; i++) {
            if (module_to_search_for === parseInt(UDS_control_units[i].substring(0, 2), 16)) {
              //Select the currently stored module
              select_mileage_device.selectedIndex = i;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_mileage_device.selectedIndex = 0;
            engine_mileage_tool.module = 0;
          }
        }
        else {
          select_mileage_device.selectedIndex = 0;
        }
        
        var input_mileage_uds_identifier = document.getElementById('input_mileage_uds_identifier');
        var select_mileage_uds_endianness = document.getElementById('select_mileage_uds_endianness');
        var select_mileage_uds_data_size = document.getElementById('select_mileage_uds_data_size');
        var select_mileage_uds_data_sign = document.getElementById('select_mileage_uds_data_sign');
        var input_mileage_uds_factor = document.getElementById('input_mileage_uds_factor');
        var input_mileage_uds_divisor = document.getElementById('input_mileage_uds_divisor');
        var input_mileage_uds_offset = document.getElementById('input_mileage_uds_offset');
        
        input_mileage_uds_identifier.value = engine_mileage_tool.identifier;
        select_mileage_uds_endianness.selectedIndex = engine_mileage_tool.endianness;
        select_mileage_uds_data_size.value = engine_mileage_tool.size;
        select_mileage_uds_data_sign.selectedIndex = engine_mileage_tool.sign;
        input_mileage_uds_factor.value = engine_mileage_tool.factor;
        input_mileage_uds_divisor.value = engine_mileage_tool.divisor;
        input_mileage_uds_offset.value = engine_mileage_tool.offset;
        break;
    }
  }
  
  //Fill the KWP modules drop-down with all available modules
  function populate_usable_kwp_devices() {
    var select_used_kwp_device = document.getElementById('select_used_kwp_device');
    var select_used_kwp_device_index = document.getElementById('select_used_kwp_device_index');
    var array_index = select_used_kwp_device_index.value - 1;
    
    //Iterate though all possible KWP modules
    for (i = 0; i < KWP_control_units.length; i++) {
      //Search the "currently used modules" array
      var remove_module = false;
      for (j = 0; j < used_kwp_devices.length; j++) {
        //If there is a module stored at the current position
        if (used_kwp_devices[j] != 0) {
          //If trying to add the module that is currently selected
          if (used_kwp_devices[j] == parseInt(KWP_control_units[i].substring(0, 2), 16)) {
            //If not on the index that has the current module selected
            if (j != array_index) {
              //Skip adding the module to the option list
              remove_module = true;
            }
            //Otherwise, the module is still added to the list so it can be rendered as currently selected
          }
        }
      }
      
      //If the current module isn't being skipped
      if (!remove_module) {
        //Add it to the list of options
        select_used_kwp_device.options.add(new Option(KWP_control_units[i]));
      }
    }
  }
  
  //Fill the UDS modules drop-down with all available modules
  function populate_usable_uds_devices() {
    var select_used_uds_device = document.getElementById('select_used_uds_device');
    var select_used_uds_device_index = document.getElementById('select_used_uds_device_index');
    var array_index = select_used_uds_device_index.value - 1;
    
    //Iterate though all possible UDS modules
    for (i = 0; i < UDS_control_units.length; i++) {
      //Search the "currently used modules" array
      var remove_module = false;
      for (j = 0; j < used_uds_devices.length; j++) {
        //If there is a module stored at the current position
        if (used_uds_devices[j] != 0) {
          //If trying to add the module that is currently selected
          if (used_uds_devices[j] == parseInt(UDS_control_units[i].substring(0, 2), 16)) {
            //If not on the index that has the current module selected
            if (j != array_index) {
              //Skip adding the module to the option list
              remove_module = true;
            }
            //Otherwise, the module is still added to the list so it can be rendered as currently selected
          }
        }
      }
      
      //If the current module isn't being skipped
      if (!remove_module) {
        //Add it to the list of options
        select_used_uds_device.options.add(new Option(UDS_control_units[i]));
      }
    }
  }
  
  //Re-populate the KWP modules drop-down with all unused modules
  function show_used_kwp_device() {
    var select_used_kwp_device = document.getElementById('select_used_kwp_device');
    var select_used_kwp_device_index = document.getElementById('select_used_kwp_device_index');
    var array_index = select_used_kwp_device_index.value - 1;
    
    //Remove all options
    for (i = select_used_kwp_device.options.length - 1; i >= 0; i--) {
        select_used_kwp_device.remove(i);
    }
    
    //The currently selected option(s) will be removed from the choosable options
    populate_usable_kwp_devices();
    
    //Add back all options except for what is already chosen
    for (i = 0; i < KWP_control_units.length; i++) {
      if (parseInt(KWP_control_units[i].substring(0, 2), 16) == used_kwp_devices[array_index]) {
        select_used_kwp_device.value = KWP_control_units[i];
        break;
      }
    }
  }
  
  //Re-populate the UDS modules drop-down with all unused modules
  function show_used_uds_device() {
    var select_used_uds_device = document.getElementById('select_used_uds_device');
    var select_used_uds_device_index = document.getElementById('select_used_uds_device_index');
    var array_index = select_used_uds_device_index.value - 1;
    
    //Remove all options
    for (i = select_used_uds_device.options.length - 1; i >= 0; i--) {
        select_used_uds_device.remove(i);
    }
    
    //The currently selected option(s) will be removed from the choosable options
    populate_usable_uds_devices();
    
    //Add back all options except for what is already chosen
    for (i = 0; i < UDS_control_units.length; i++) {      
      if (parseInt(UDS_control_units[i].substring(0, 2), 16) == used_uds_devices[array_index]) {
        select_used_uds_device.value = UDS_control_units[i];
        break;
      }
    }
  }
  
  //Save the selected KWP module
  function save_used_kwp_device() {
    var select_used_kwp_device = document.getElementById('select_used_kwp_device');
    var select_used_kwp_device_index = document.getElementById('select_used_kwp_device_index');
    
    //Store the module in the array
    var array_index = select_used_kwp_device_index.value - 1;
    used_kwp_devices[array_index] = parseInt(select_used_kwp_device.value.substring(0, 2), 16);
    
    //If the selected protocol isn't KWP, don't continue
    var select_protocol = document.getElementById('select_protocol');
    if (select_protocol.selectedIndex != 0) {
      return;
    }
    
    //Remove all options for the source device
    var select_device = document.getElementById('select_device');
    for (i = select_device.options.length - 1; i >= 0; i--) {
      select_device.remove(i);
    }
    
    //Add the "not used" option
    select_device.options.add(new Option(KWP_control_units[0]));
    
    //Add all used modules
    for (i = 0; i < used_kwp_devices.length; i++) {
      if (used_kwp_devices[i]) {
        for (j = 0; j < KWP_control_units.length; j++) {
          if (parseInt(KWP_control_units[j].substring(0, 2), 16) == used_kwp_devices[i]) {
            select_device.options.add(new Option(KWP_control_units[j]));
            break;
          }
        }
      }
    }
    
    //Select the "not used" option
    select_device.selectedIndex = 0;
    
    //If the source device of any parameter from any page is a module which is no longer used, change it to 0
    for (i = 0; i < page_array.length; i++) {
      for (j = 0; j < page_array[i].parameters.length; j++) {
        var parameter_module = page_array[i].parameters[j].source.module;
        if (parameter_module) {
          var found = false;
          for (k = 0; k < used_kwp_devices.length; k++) {
            if (parameter_module == used_kwp_devices[k]) {
              found = true;
              break;
            }
          }
          
          if (!found) {
            page_array[i].parameters[j].source.module = 0;
          }
        }
      }
    }
  }
  
  //Save the selected UDS module
  function save_used_uds_device() {
    var select_used_uds_device = document.getElementById('select_used_uds_device');
    var select_used_uds_device_index = document.getElementById('select_used_uds_device_index');
    
    //Store the module in the array
    var array_index = select_used_uds_device_index.value - 1;
    used_uds_devices[array_index] = parseInt(select_used_uds_device.value.substring(0, 2), 16)
    
    //If the selected protocol isn't UDS, don't continue
    var select_protocol = document.getElementById('select_protocol');
    if (select_protocol.selectedIndex != 1) {
      return;
    }
    
    //Remove all options for the source device
    var select_device = document.getElementById('select_device');
    for (i = select_device.options.length - 1; i >= 0; i--) {
      select_device.remove(i);
    }
    
    //Add the "not used" option
    select_device.options.add(new Option(UDS_control_units[0]));
    
    //Add all used modules
    for (i = 0; i < used_uds_devices.length; i++) {
      if (used_uds_devices[i]) {
        for (j = 0; j < UDS_control_units.length; j++) {
          if (parseInt(UDS_control_units[j].substring(0, 2), 16) == used_uds_devices[i]) {
            select_device.options.add(new Option(UDS_control_units[j]));
            break;
          }
        }
      }
    }
    
    //Select the "not used" option
    select_device.selectedIndex = 0;
    
    //If the source device of any parameter from any page is a module which is no longer used, change it to 0
    for (i = 0; i < page_array.length; i++) {
      for (j = 0; j < page_array[i].parameters.length; j++) {
        var parameter_module = page_array[i].parameters[j].source.module;
        if (parameter_module) {
          var found = false;
          for (k = 0; k < used_uds_devices.length; k++) {
            if (parameter_module == used_uds_devices[k]) {
              found = true;
              break;
            }
          }
          
          if (!found) {
            page_array[i].parameters[j].source.module = 0;
          }
        }
      }
    }
  }
  
  //Add a new page
  function add_page() {
    var select_page = document.getElementById('select_page');
    
    //If no more pages can be added, exit
    var current_amount_of_pages = page_array.length;
    if (current_amount_of_pages >= 100) {
      return;
    }
    
    //Determine where to insert the new page
    var where_to_add_page = 0;
    if (select_page.options.length != 0) {
      where_to_add_page = select_page.value;
    }
    
    //Add a new option
    select_page.options.add(new Option(select_page.options.length + 1));
    
    //Empty page entry
    const page = {
      settings: 0,
      index: 0,
      title: '',
      parameters: []
    };
    
    //Insert the entry in the page array at the determined position
    page_array.splice(where_to_add_page, 0, page);
    
    //Rewrite the indexes
    for (i = 0; i < page_array.length; i++) {
      page_array[i].index = i;
    }
    
    //Select the newly created page
    change_to_page(where_to_add_page);
    
    //Add a new parameter to the new page
    add_parameter();
  }
  
  //Remove a page
  function remove_page() {
    var select_page = document.getElementById('select_page');
    var page_index_to_remove = select_page.selectedIndex;
    
    //If there is only one page, it can't be removed
    if (select_page.options.length > 1) {
      if (!confirm(S_are_you_sure_you_want_to_delete_page + (page_index_to_remove + 1) + S_question + S_this_cannot_be_undone)) {
        return;
      }
      
      //Remove the requested page
      page_array.splice(page_index_to_remove, 1);
      
      //Remove all options
      for (i = (select_page.options.length - 1); i >= 0; i--) {
        select_page.remove(i);
      }
      
      //Add back all options (to ensure pages start at index 0 and do not skip values)
      for (i = 0; i < page_array.length; i++) {
        select_page.options.add(new Option(i + 1));
        page_array[i].index = i;
      }
      
      change_to_page(page_index_to_remove - (page_index_to_remove != 0));
      change_to_parameter(0);
    }
  }
  
  //Select the requested page
  function change_to_page(page_to_change_to) {
    var select_page = document.getElementById('select_page');
    select_page.selectedIndex = page_to_change_to;
    
    var aligned_units_checkbox = document.getElementById('aligned_units_checkbox');
    aligned_units_checkbox.checked = page_array[page_to_change_to].settings & (1 << 0);
    
    var bar_at_bottom_checkbox = document.getElementById('bar_at_bottom_checkbox');
    bar_at_bottom_checkbox.checked = page_array[page_to_change_to].settings & (1 << 1);
    
    //Fill in the page's title
    var input_page_title = document.getElementById('input_page_title');
    input_page_title.value = page_array[page_to_change_to].title;
    
    //Remove all options
    var select_parameter = document.getElementById('select_parameter');
    for (i = (select_parameter.options.length - 1); i >= 0; i--) {
        select_parameter.remove(i);
    }
    
    //Add back all options
    for (i = 0; i < page_array[page_to_change_to].parameters.length; i++) {
      select_parameter.options.add(new Option(i + 1));
    }
  }
  
  //Add a new parameter
  function add_parameter() {
    var select_page = document.getElementById('select_page');
    
    //If no more parameters can be added, exit
    var current_amount_of_parameters = page_array[select_page.selectedIndex].parameters.length;
    if (current_amount_of_parameters >= 5) {
      return;
    }
    
    var select_parameter = document.getElementById('select_parameter');
    
    //Determine where to insert the new parameter
    var where_to_add_parameter = 0;
    if (select_parameter.options.length != 0) {
      where_to_add_parameter = select_parameter.value;
    }
    
    //Add a new option
    select_parameter.options.add(new Option(select_parameter.options.length + 1));
    
    //Empty parameter entry
    const parameter = {
      settings: 0,
      index: 0,
      name: '',
      units: '',
      source: {},
      display: {},
      warning: {},
      graph: {}
    };
    
    //Insert the entry in the parameter array at the determined position
    page_array[select_page.selectedIndex].parameters.splice(where_to_add_parameter, 0, parameter);
    
    //Rewrite the indexes
    for (i = 0; i < page_array[select_page.selectedIndex].parameters.length; i++) {
      page_array[select_page.selectedIndex].parameters[i].index = i;
    }
        
    //Select the newly created parameter
    change_to_parameter(where_to_add_parameter);
    
    //Default the parameter's source to KWP
    change_parameter_protocol(0);
    
    change_display_mode(0);
    change_warning_mode(0);
    create_graph_parameters();
  }
  
  //Remove a parameter
  function remove_parameter() {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    var parameter_index_to_remove = select_parameter.selectedIndex;
    
    //If there is only one parameter, it can't be removed
    if (select_parameter.options.length > 1) {
      if (!confirm(S_are_you_sure_you_want_to_delete_parameter + (parameter_index_to_remove + 1) + S_question + S_this_cannot_be_undone)) {
        return;
      }
    
      //Remove the requested parameter
      page_array[select_page.selectedIndex].parameters.splice(parameter_index_to_remove, 1);
      
      //Remove all options
      for (i = (select_parameter.options.length - 1); i >= 0; i--) {
        select_parameter.remove(i);
      }
      
      //Add back all options (to ensure parameters start at index 0 and do not skip values)
      for (i = 0; i < page_array[select_page.selectedIndex].parameters.length; i++) {
        select_parameter.options.add(new Option(i + 1));
        page_array[select_page.selectedIndex].parameters[i].index = i;
      }
      
      change_to_parameter(parameter_index_to_remove - (parameter_index_to_remove != 0));
    }
  }
  
  //Select the requested parameter
  function change_to_parameter(parameter_to_change_to) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    select_parameter.selectedIndex = parameter_to_change_to;
    
    //Fill in the parameter's name
    var input_parameter_name = document.getElementById('input_parameter_name');
    input_parameter_name.value = page_array[select_page.selectedIndex].parameters[parameter_to_change_to].name;
    
    //Fill in the parameter's units
    var input_parameter_units = document.getElementById('input_parameter_units');
    input_parameter_units.value = page_array[select_page.selectedIndex].parameters[parameter_to_change_to].units;
    
    show_parameter_protocol();
    show_parameter_display();
    show_warning_mode();
    show_graph_parameters();
  }
  
  //Protocol: 0=KWP, 1=UDS, 2=Wi-Fi
  function change_parameter_protocol(protocol) {
    var source = {};
    
    switch (protocol) {
      case 0:
        source = {
          protocol: 0,
          module: 0,
          block: 1,
          index: 1
        };
        break;
      
      case 1:
        source = {
          protocol: 1,
          module: 0,
          identifier: 0,
          endianness: 0,
          index: 0,
          size: 1,
          sign: 0,
          factor: 1,
          divisor: 1,
          offset: 0
        };
        break;
      
      case 2:
        source = {
          protocol: 2,
          device: 0,
          measurement: 0
        };
        break;
    }
    
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source = source;
    
    show_parameter_protocol();
    show_parameter_display();
    show_warning_mode();
  }
  
  function change_speed_device(obj) {
    acceleration_timer_tool.module = parseInt(obj.value.substring(0, 2), 16);
  }
  
  function change_oil_level_device(obj) {
    oil_level_checker_tool.module = parseInt(obj.value.substring(0, 2), 16);
  }
  
  function change_mileage_device(obj) {
    engine_mileage_tool.module = parseInt(obj.value.substring(0, 2), 16);
  }
  
  function set_speed_kwp_block(obj) {
    acceleration_timer_tool.block = obj.selectedIndex + 1;
  }
  
  function set_oil_level_kwp_block(obj) {
    oil_level_checker_tool.block = obj.selectedIndex + 1;
  }
  
  function set_oil_temperature_kwp_block(obj) {
    oil_level_checker_tool.block_temp = obj.selectedIndex + 1;
  }
  
  function set_mileage_kwp_block(obj) {
    engine_mileage_tool.block = obj.selectedIndex + 1;
  }
  
  function set_speed_kwp_index(obj) {
    acceleration_timer_tool.index = obj.selectedIndex + 1;
  }
  
  function set_oil_level_kwp_index(obj) {
    oil_level_checker_tool.index = obj.selectedIndex + 1;
  }
  
  function set_oil_temperature_kwp_index(obj) {
    oil_level_checker_tool.index_temp = obj.selectedIndex + 1;
  }
  
  function set_mileage_kwp_index(obj) {
    engine_mileage_tool.index = obj.selectedIndex + 1;
  }
  
  function set_speed_uds_identifier(obj) {
    var identifier = parseInt(obj.value);
    
    if (isNaN(identifier)) {
      identifier = 0;
      obj.value = 0;
    }
    else {
      if (identifier < 0) {
        identifier = 0;
        obj.value = 0;
      }
      
      if (identifier > 65535) {
        identifier = 65535;
        obj.value = 65535;
      }
      
      identifier = Math.trunc(identifier);
      obj.value = identifier;
    }
    
    acceleration_timer_tool.identifier = identifier;
  }
  
  function set_oil_level_uds_identifier(obj) {
    var identifier = parseInt(obj.value);
    
    if (isNaN(identifier)) {
      identifier = 0;
      obj.value = 0;
    }
    else {
      if (identifier < 0) {
        identifier = 0;
        obj.value = 0;
      }
      
      if (identifier > 65535) {
        identifier = 65535;
        obj.value = 65535;
      }
      
      identifier = Math.trunc(identifier);
      obj.value = identifier;
    }
    
    oil_level_checker_tool.identifier = identifier;
  }
  
  function set_oil_temperature_uds_identifier(obj) {
    var identifier = parseInt(obj.value);
    
    if (isNaN(identifier)) {
      identifier = 0;
      obj.value = 0;
    }
    else {
      if (identifier < 0) {
        identifier = 0;
        obj.value = 0;
      }
      
      if (identifier > 65535) {
        identifier = 65535;
        obj.value = 65535;
      }
      
      identifier = Math.trunc(identifier);
      obj.value = identifier;
    }
    
    oil_level_checker_tool.identifier_temp = identifier;
  }
  
  function set_mileage_uds_identifier(obj) {
    var identifier = parseInt(obj.value);
    
    if (isNaN(identifier)) {
      identifier = 0;
      obj.value = 0;
    }
    else {
      if (identifier < 0) {
        identifier = 0;
        obj.value = 0;
      }
      
      if (identifier > 65535) {
        identifier = 65535;
        obj.value = 65535;
      }
      
      identifier = Math.trunc(identifier);
      obj.value = identifier;
    }
    
    engine_mileage_tool.identifier = identifier;
  }
  
  function set_speed_uds_endianness(obj) {
    acceleration_timer_tool.endianness = obj.selectedIndex;
  }
  
  function set_oil_level_uds_endianness(obj) {
    oil_level_checker_tool.endianness = obj.selectedIndex;
  }
  
  function set_oil_temperature_uds_endianness(obj) {
    oil_level_checker_tool.endianness_temp = obj.selectedIndex;
  }
  
  function set_mileage_uds_endianness(obj) {
    engine_mileage_tool.endianness = obj.selectedIndex;
  }
  
  function set_speed_uds_size(obj) {
    var size = parseInt(obj.value);
    acceleration_timer_tool.size = size;
  }
  
  function set_oil_level_uds_size(obj) {
    var size = parseInt(obj.value);
    oil_level_checker_tool.size = size;
  }
  
  function set_oil_temperature_uds_size(obj) {
    var size = parseInt(obj.value);
    oil_level_checker_tool.size_temp = size;
  }
  
  function set_mileage_uds_size(obj) {
    var size = parseInt(obj.value);
    engine_mileage_tool.size = size;
  }
  
  function set_speed_uds_sign(obj) {
    acceleration_timer_tool.sign = obj.selectedIndex;
  }
  
  function set_oil_level_uds_sign(obj) {
    oil_level_checker_tool.sign = obj.selectedIndex;
  }
  
  function set_oil_temperature_uds_sign(obj) {
    oil_level_checker_tool.sign_temp = obj.selectedIndex;
  }
  
  function set_mileage_uds_sign(obj) {
    engine_mileage_tool.sign = obj.selectedIndex;
  }
  
  function set_speed_uds_factor(obj) {
    var factor = parseInt(obj.value);
    
    if (isNaN(factor)) {
      factor = 0;
      obj.value = 0;
    }
    else {
      if (factor < 0) {
        factor = 0;
        obj.value = 0;
      }
      
      if (factor > 65535) {
        factor = 65535;
        obj.value = 65535;
      }
      
      factor = Math.trunc(factor);
      obj.value = factor;
    }
    
    acceleration_timer_tool.factor = factor;
  }
  
  function set_oil_level_uds_factor(obj) {
    var factor = parseInt(obj.value);
    
    if (isNaN(factor)) {
      factor = 0;
      obj.value = 0;
    }
    else {
      if (factor < 0) {
        factor = 0;
        obj.value = 0;
      }
      
      if (factor > 65535) {
        factor = 65535;
        obj.value = 65535;
      }
      
      factor = Math.trunc(factor);
      obj.value = factor;
    }
    
    oil_level_checker_tool.factor = factor;
  }
  
  function set_oil_temperature_uds_factor(obj) {
    var factor = parseInt(obj.value);
    
    if (isNaN(factor)) {
      factor = 0;
      obj.value = 0;
    }
    else {
      if (factor < 0) {
        factor = 0;
        obj.value = 0;
      }
      
      if (factor > 65535) {
        factor = 65535;
        obj.value = 65535;
      }
      
      factor = Math.trunc(factor);
      obj.value = factor;
    }
    
    oil_level_checker_tool.factor_temp = factor;
  }
  
  function set_mileage_uds_factor(obj) {
    var factor = parseInt(obj.value);
    
    if (isNaN(factor)) {
      factor = 0;
      obj.value = 0;
    }
    else {
      if (factor < 0) {
        factor = 0;
        obj.value = 0;
      }
      
      if (factor > 65535) {
        factor = 65535;
        obj.value = 65535;
      }
      
      factor = Math.trunc(factor);
      obj.value = factor;
    }
    
    engine_mileage_tool.factor = factor;
  }
  
  function set_speed_uds_divisor(obj) {
    var divisor = parseInt(obj.value);
    
    if (isNaN(divisor)) {
      divisor = 0;
      obj.value = 0;
    }
    else {
      if (divisor < 0) {
        divisor = 0;
        obj.value = 0;
      }
      
      if (divisor > 65535) {
        divisor = 65535;
        obj.value = 65535;
      }
      
      divisor = Math.trunc(divisor);
      obj.value = divisor;
    }
    
    acceleration_timer_tool.divisor = divisor;
  }
  
  function set_oil_level_uds_divisor(obj) {
    var divisor = parseInt(obj.value);
    
    if (isNaN(divisor)) {
      divisor = 0;
      obj.value = 0;
    }
    else {
      if (divisor < 0) {
        divisor = 0;
        obj.value = 0;
      }
      
      if (divisor > 65535) {
        divisor = 65535;
        obj.value = 65535;
      }
      
      divisor = Math.trunc(divisor);
      obj.value = divisor;
    }
    
    oil_level_checker_tool.divisor = divisor;
  }
  
  function set_oil_temperature_uds_divisor(obj) {
    var divisor = parseInt(obj.value);
    
    if (isNaN(divisor)) {
      divisor = 0;
      obj.value = 0;
    }
    else {
      if (divisor < 0) {
        divisor = 0;
        obj.value = 0;
      }
      
      if (divisor > 65535) {
        divisor = 65535;
        obj.value = 65535;
      }
      
      divisor = Math.trunc(divisor);
      obj.value = divisor;
    }
    
    oil_level_checker_tool.divisor_temp = divisor;
  }
  
  function set_mileage_uds_divisor(obj) {
    var divisor = parseInt(obj.value);
    
    if (isNaN(divisor)) {
      divisor = 0;
      obj.value = 0;
    }
    else {
      if (divisor < 0) {
        divisor = 0;
        obj.value = 0;
      }
      
      if (divisor > 65535) {
        divisor = 65535;
        obj.value = 65535;
      }
      
      divisor = Math.trunc(divisor);
      obj.value = divisor;
    }
    
    engine_mileage_tool.divisor = divisor;
  }
  
  function set_speed_uds_offset(obj) {
    var offset = parseFloat(obj.value);
    if (isNaN(offset)) {
      offset = 0;
      obj.value = 0;
    }
    
    acceleration_timer_tool.offset = offset;
  }
  
  function set_oil_level_uds_offset(obj) {
    var offset = parseFloat(obj.value);
    if (isNaN(offset)) {
      offset = 0;
      obj.value = 0;
    }
    
    oil_level_checker_tool.offset = offset;
  }
  
  function set_oil_temperature_uds_offset(obj) {
    var offset = parseFloat(obj.value);
    if (isNaN(offset)) {
      offset = 0;
      obj.value = 0;
    }
    
    oil_level_checker_tool.offset_temp = offset;
  }
  
  function set_mileage_uds_offset(obj) {
    var offset = parseFloat(obj.value);
    if (isNaN(offset)) {
      offset = 0;
      obj.value = 0;
    }
    
    engine_mileage_tool.offset = offset;
  }
  
  function set_mileage_offset(obj) {
    var km_offset = parseFloat(obj.value);
    if (isNaN(km_offset)) {
      km_offset = 0;
      obj.value = 0;
    }
    else {
      if (km_offset < 0) {
        km_offset = 0;
        obj.value = 0;
      }
    }
    
    engine_mileage_tool.km_offset = km_offset;
  }
  
  function set_oil_level_min(obj) {
    var min = parseFloat(obj.value);
    if (isNaN(min)) {
      min = 0;
      obj.value = 0;
    }
    
    oil_level_checker_tool.min = min;
  }
  
  function set_oil_level_max(obj) {
    var max = parseFloat(obj.value);
    if (isNaN(max)) {
      max = 0;
      obj.value = 0;
    }
    
    oil_level_checker_tool.max = max;
  }
  
  function set_graph_top(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var top = parseFloat(obj.value);
    
    if (isNaN(top)) {
      top = 0;
      obj.value = 0;
    }
    else {
      if (top < -10000) {
        top = -10000;
        obj.value = -10000;
      }
      
      if (top > 10000) {
        top = 10000;
        obj.value = 10000;
      }
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph.top = top;
  }
  
  function set_graph_bottom(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var bottom = parseFloat(obj.value);
    
    if (isNaN(bottom)) {
      bottom = 0;
      obj.value = 0;
    }
    else {
      if (bottom < -10000) {
        bottom = -10000;
        obj.value = -10000;
      }
      
      if (bottom > 10000) {
        bottom = 10000;
        obj.value = 10000;
      }
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph.bottom = bottom;
  }
  
  function set_graph_rate(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var rate = parseInt(obj.value);
    
    if (isNaN(rate)) {
      rate = 0;
      obj.value = 0;
    }
    else {
      if (rate < 10) {
        rate = 10;
        obj.value = 10;
      }
      
      if (rate > 1000) {
        rate = 1000;
        obj.value = 1000;
      }
      
      rate = Math.trunc(rate);
      obj.value = rate;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph.rate = rate;
  }
  
  function change_parameter_device() {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    var select_device = document.getElementById('select_device');
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.module = parseInt(select_device.value.substring(0, 2), 16);
  }
  
  function change_parameter_wifi_device() {
    var select_wifi_device = document.getElementById('select_wifi_device');
    var select_wifi_device_measurement = document.getElementById('select_wifi_device_measurement');
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    for (i = (select_wifi_device_measurement.options.length - 1); i >= 0; i--) {
      select_wifi_device_measurement.remove(i);
    }
    
    switch (select_wifi_device.value) {
      case "OpenHaldex":
        select_wifi_device_measurement.options.add(new Option("mode"));
        select_wifi_device_measurement.options.add(new Option("lockTarget"));
        select_wifi_device_measurement.options.add(new Option("haldexEngagement"));
        select_wifi_device_measurement.options.add(new Option("pedalValue"));
        select_wifi_device_measurement.options.add(new Option("vehicleSpeed"));
        
        page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.device = 0;
        break;
    }
  }
  
  function show_parameter_protocol() {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    var protocol = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.protocol;
    
    var protocol_header_row = document.getElementById('protocol_header_row');
    var protocol_data_row = document.getElementById('protocol_data_row');
    
    switch (protocol) {
      case 0:
        protocol_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>' + S_block + '</th>' + 
          '<th>' + S_index + '</th>';
        
        protocol_data_row.innerHTML =
          '<td>' + 
          '<select id="select_protocol" onchange=change_parameter_protocol(this.selectedIndex)>' +
          '<option selected>KWP</option>' +
          '<option>UDS</option>' +
          '<option>Wi-Fi</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_device" onchange="change_parameter_device()">' +
          '</select>' +
          '</td>' +
          '<td><select id="select_kwp_block" onchange="set_parameter_kwp_block(this)"></select></td>' +
          '<td><select id="select_kwp_index" onchange="set_parameter_kwp_index(this)"></select></td>';
        
        select_device.options.add(new Option(KWP_control_units[0]));
        
        //Add all used device options
        for (j = 0; j < used_kwp_devices.length; j++) {
          if (used_kwp_devices[j] != 0) {
            for (i = 0; i < KWP_control_units.length; i++) {
              if (used_kwp_devices[j] == parseInt(KWP_control_units[i].substring(0, 2), 16)) {
                select_device.options.add(new Option(KWP_control_units[i]));
                break;
              }
            }
          }
        }
        
        //Search for the currently stored module
        var module_to_search_for = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.module;
        
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of used KWP modules
          var found = false;
          for(i = 0; i < used_kwp_devices.length; i++) {
            if (module_to_search_for == used_kwp_devices[i]) {
              //Select the currently stored module
              select_device.selectedIndex = i + 1;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_device.selectedIndex = 0;
            page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.module = 0;
          }
        }
        else {
          select_device.selectedIndex = 0;
        }
        
        //Populate the block drop-down
        var select_kwp_block = document.getElementById('select_kwp_block');
        for (i = 1; i <= 254; i++) {
          select_kwp_block.options.add(new Option(i));
        }
        
        //Populate the index drop-down
        var select_kwp_index = document.getElementById('select_kwp_index');
        for (i = 1; i <= 4; i++) {
          select_kwp_index.options.add(new Option(i));
        }
        
        //Select the block and index according to what is stored
        select_kwp_block.selectedIndex = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.block - 1;
        select_kwp_index.selectedIndex = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.index - 1;
        break;
      
      case 1:
        protocol_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>ID</th>' + 
          '<th>E</th>' +
          '<th>I</th>' +
          '<th>SZ</th>' +
          '<th>SG</th>' +
          '<th>F</th>' +
          '<th>D</th>' +
          '<th>O</th>';
        
        protocol_data_row.innerHTML =
          '<td>' + 
          '<select id="select_protocol" onchange=change_parameter_protocol(this.selectedIndex)>' +
          '<option>KWP</option>' +
          '<option selected>UDS</option>' +
          '<option>Wi-Fi</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_device" onchange="change_parameter_device()">' +
          '</select>' +
          '</td>' +
          '<td><input type="number" id="input_identifier" onchange="set_parameter_uds_identifier(this)"></input></td>' +
          '<td><select id="select_endianness" onchange="set_parameter_uds_endianness(this)"><option>Little<option>Big</select></td>' +
          '<td><input type="number" id="input_index" onchange="set_parameter_uds_index(this)"></input></td>' +
          '<td><select id="select_data_size" onchange="set_parameter_uds_size(this)"><option>1<option>2<option>4<option>8</select></td>' +
          '<td><select id="select_data_sign" onchange="set_parameter_uds_sign(this)"><option>Unsigned<option>Signed</select></td>' +
          '<td><input type="number" id="input_factor" onchange="set_parameter_uds_factor(this)"></input></td>' +
          '<td><input type="number" id="input_divisor" onchange="set_parameter_uds_divisor(this)"></input></td>' +
          '<td><input type="number" id="input_offset" onchange="set_parameter_uds_offset(this)"></input></td>';
        
        select_device.options.add(new Option(UDS_control_units[0]));
        
        //Add all used device options
        for (j = 0; j < used_uds_devices.length; j++) {
          if (used_uds_devices[j] != 0) {
            for (i = 0; i < UDS_control_units.length; i++) {
              if (used_uds_devices[j] == parseInt(UDS_control_units[i].substring(0, 2), 16)) {
                select_device.options.add(new Option(UDS_control_units[i]));
                break;
              }
            }
          }
        }
        
        //Search for the currently stored module
        var module_to_search_for = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.module;
        if (module_to_search_for != 0) {
          //Search for the parameter's device in the list of used KWP modules
          var found = false;
          for(i = 0; i < used_uds_devices.length; i++) {
            if (module_to_search_for == used_uds_devices[i]) {
              //Select the currently stored module
              select_device.selectedIndex = i + 1;
              found = true;
              break;
            }
          }
          
          //If the module isn't found, set it to "not used"
          if (!found) {
            select_device.selectedIndex = 0;
          }
        }
        else {
          select_device.selectedIndex = 0;
        }
        
        var input_identifier = document.getElementById('input_identifier');
        var select_endianness = document.getElementById('select_endianness');
        var input_index = document.getElementById('input_index');
        var select_data_size = document.getElementById('select_data_size');
        var select_data_sign = document.getElementById('select_data_sign');
        var input_factor = document.getElementById('input_factor');
        var input_divisor = document.getElementById('input_divisor');
        var input_offset = document.getElementById('input_offset');
        
        input_identifier.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.identifier;
        select_endianness.selectedIndex = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.endianness;
        input_index.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.index;
        select_data_size.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.size;
        select_data_sign.selectedIndex = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.sign;
        input_factor.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.factor;
        input_divisor.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.divisor;
        input_offset.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.offset;
        break;
        
      case 2:
        protocol_header_row.innerHTML =
          '<th>' + S_protocol + '</th>' + 
          '<th>' + S_device + '</th>'+
          '<th>' + S_measurement + '</th>';
        
        protocol_data_row.innerHTML =
          '<td>' + 
          '<select id="select_protocol" onchange=change_parameter_protocol(this.selectedIndex)>' +
          '<option>KWP</option>' +
          '<option>UDS</option>' +
          '<option selected>Wi-Fi</option>' +
          '</select>' +
          '</td>' +
          '<td>' + 
          '<select id="select_wifi_device" onchange="change_parameter_wifi_device()">' +
          '</select>' +
          '</td>' +
          '<td><select id="select_wifi_device_measurement" onchange="set_parameter_wifi_device_measurement(this)"></select></td>';
        
        var select_wifi_device = document.getElementById('select_wifi_device');
        var select_wifi_device_measurement = document.getElementById('select_wifi_device_measurement');
        
        select_wifi_device.options.add(new Option("OpenHaldex"));
        
        change_parameter_wifi_device();
        
        //Select the device and measurement according to what is stored
        select_wifi_device.selectedIndex = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.device;
        select_wifi_device_measurement.selectedIndex = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.measurement;
        break;
    }
  }
  
  function change_display_mode(mode) {
    var display = {};
    
    switch (mode) {
      case 0: //exact value
        display = {
          mode: mode,
          forced: 0,
          decimals: 0
        };
        break;
      
      case 1: //mapped value
        display = {
          mode: mode,
          offset: 0,
          in_min: 0,
          in_max: 0,
          out_min: 0,
          out_max: 0,
          limit_min: 0,
          limit_max: 0,
          decimals: 0
        };
        break;
      
      case 2: //custom text
        display = {
          mode: mode,
          condition: {}
        };
        break;
    }
    
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display = display;
    
    show_parameter_display();
    
    if (mode === 2) {
      change_display_custom_text_condition(0);
    }
  }
  
  function show_parameter_display() {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    var mode = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.mode;
    
    var display_header_row = document.getElementById('display_header_row');
    var display_data_row = document.getElementById('display_data_row');
    
    switch (mode) {
      case 0:
        display_header_row.innerHTML =
          '<th>' + S_mode + '</th>' +
          '<th>' + S_forced_value + '</th>' +
          '<th>' + S_decimals + '</th>';
        
        display_data_row.innerHTML =
          '<td>' +
          '<select id="select_display_mode" onchange="change_display_mode(this.selectedIndex)">' +
          '<option selected>' + S_exact_value +
          '<option>' + S_mapped_value +
          '<option>' + S_custom_text +
          '</select>' +
          '</td>' +
          '<td>' +
          '<input id="force_checkbox" type="checkbox" onchange="set_parameter_display_forced(this)">' +
          '</td>' +
          '<td>' +
          '<select id="select_display_decimals" onchange="set_parameter_display_decimals(this)"></select>' +
          '</td>';
        
        var select_display_decimals = document.getElementById('select_display_decimals');
        for (i = 0; i <= 3; i++) {
          select_display_decimals.options.add(new Option(i));
        }
        
        select_display_decimals.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.decimals;
        
        var force_checkbox = document.getElementById('force_checkbox');
        force_checkbox.checked = (page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.forced === 1);
        break;
      
      case 1:
        display_header_row.innerHTML =
          '<th>' + S_mode + '</th>' +
          '<th>' + S_offset + '</th>' +
          '<th rowspan=2>' +
          '<table style="border-style:none;">' +
          '<tbody>' +
          '<tr>' +
          '<th></th>' +
          '<th>' + S_in + '</th>' +
          '<th>' + S_out + '</th>' +
          '<th>' + S_limit + '</th>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_min + '</td>' +
          '<td><input type="number" id="input_map_in_min" onchange="set_parameter_display_map_in_min(this)"></td>' +
          '<td><input type="number" id="input_map_out_min" onchange="set_parameter_display_map_out_min(this)"></td>' +
          '<td><input type="checkbox" id="map_checkbox_limit_min" onchange="set_parameter_display_map_limit_min(this)"></td>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_max + '</td>' +
          '<td><input type="number" id="input_map_in_max" onchange="set_parameter_display_map_in_max(this)"></td>' +
          '<td><input type="number" id="input_map_out_max" onchange="set_parameter_display_map_out_max(this)"></td>' +
          '<td><input type="checkbox" id="map_checkbox_limit_max" onchange="set_parameter_display_map_limit_max(this)"></td>' +
          '</tr>' +
          '</tbody>' +
          '</table>' +
          '</th>' +
          '<th>' + S_decimals + '</th>';
        
        display_data_row.innerHTML =
          '<td>' +
          '<select id="select_display_mode" onchange="change_display_mode(this.selectedIndex)">' +
          '<option>' + S_exact_value +
          '<option selected>' + S_mapped_value +
          '<option>' + S_custom_text +
          '</select>' +
          '</td>' +
          '<td><input type="number" id="input_map_offset" onchange="set_parameter_display_map_offset(this)"></input></td>' +
          '<td><select id="select_display_decimals" onchange="set_parameter_display_decimals(this)"></select></td>';
        
        var select_display_decimals = document.getElementById('select_display_decimals');
        for (i = 0; i <= 3; i++) {
          select_display_decimals.options.add(new Option(i));
        }
        
        select_display_decimals.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.decimals;
        
        var input_map_offset = document.getElementById('input_map_offset');
        var input_map_in_min = document.getElementById('input_map_in_min');
        var input_map_out_min = document.getElementById('input_map_out_min');
        var map_checkbox_limit_min = document.getElementById('map_checkbox_limit_min');
        var input_map_in_max = document.getElementById('input_map_in_max');
        var input_map_out_max = document.getElementById('input_map_out_max');
        var map_checkbox_limit_max = document.getElementById('map_checkbox_limit_max');
        
        input_map_offset.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.offset;
        input_map_in_min.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.in_min;
        input_map_out_min.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.out_min;
        map_checkbox_limit_min.checked = (page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.limit_min === 1);
        input_map_in_max.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.in_max;
        input_map_out_max.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.out_max;
        map_checkbox_limit_max.checked = (page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.limit_max === 1);
        break;
      
      case 2:
        display_header_row.innerHTML =
          '<th>' + S_mode + '</th>' +
          '<th>' + S_condition + '</th>' +
          '<td rowspan=2 id="display_condition_data_row"></td>';
        
        display_data_row.innerHTML =
          '<td>' +
          '<select id="select_display_mode" onchange="change_display_mode(this.selectedIndex)">' +
          '<option>' + S_exact_value +
          '<option>' + S_mapped_value +
          '<option selected>' + S_custom_text +
          '</select>' +
          '</td>' +
          '<td>' +
          '<select id="select_custom_text_condition" onchange="change_display_custom_text_condition(this.selectedIndex)">' +
          '<option>' + S_if_value_if_not_value +
          '<option>' + S_if_inside_outside_range +
          '<option>' + S_if_below_inside_above_range +
          '</select>' +
          '</td>';
        
        show_display_custom_text_condition();
        break;
    }
  }
  
  function change_display_custom_text_condition(condition_type) {
    var condition = {};
    
    switch (condition_type) {
      case 0:
        condition = {
          type: 0,
          value: 0,
          if_value: "",
          if_not_value: ""
        };
        break;
      
      case 1:
        condition = {
          type: 1,
          range_min: 0,
          range_max: 0,
          inside_range: "",
          outside_range: ""
        };
        break;
      
      case 2:
        condition = {
          type: 2,
          range_min: 0,
          range_max: 0,
          below_range: "",
          inside_range: "",
          above_range: ""
        };
        break;
    }
    
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition = condition;
    
    show_display_custom_text_condition();
  }
  
  function show_display_custom_text_condition() {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    var condition = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition;
    
    var select_custom_text_condition = document.getElementById('select_custom_text_condition');
    select_custom_text_condition.selectedIndex = condition.type;
    
    var display_condition_data_row = document.getElementById('display_condition_data_row');
    
    switch (condition.type) {
      case 0:
        display_condition_data_row.innerHTML =
          '<table style="border-style:none;">' +
          '<tr>' +
          '<th>' + S_value + '</th>' +
          '<th>' + S_if_value + '</th>' +
          '<th>' + S_if_not_value + '</th>' +
          '</tr>' +
          '<tr>' +
          '<td><input type="number" id="input_condition_value" onchange="set_display_custom_text_cond0_value(this)"></input></td>' +
          '<td><input type="text" id="input_condition_if_value_text" placeholder="' + S_equals_value + '" onchange="set_display_custom_text_cond0_if_value_text(this)"></input></td>' +
          '<td><input type="text" id="input_condition_if_not_value_text" placeholder="' + S_doesnt_equal_value + '" onchange="set_display_custom_text_cond0_if_not_value_text(this)"></input></td>' +
          '</tr>' +
          '</table>';
        
        var input_condition_value = document.getElementById('input_condition_value');
        var input_condition_if_value_text = document.getElementById('input_condition_if_value_text');
        var input_condition_if_not_value_text = document.getElementById('input_condition_if_not_value_text');
        
        input_condition_value.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.value;
        input_condition_if_value_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.if_value;
        input_condition_if_not_value_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.if_not_value;
        break;
      
      case 1:
        display_condition_data_row.innerHTML =
          '<table style="border-style:none;">' +
          '<tr>' +
          '<th colspan=2>Range</th>' +
          '<th>' + S_inside + '</th>' +
          '<th>' + S_outside + '</th>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_min + '</td>' +
          '<td><input type="number" id="input_condition_range_min" onchange="set_display_custom_text_condition_range_min(this)"></input></td>' +
          '<td rowspan=2><input type="text" id="input_condition_inside_range_text" placeholder="' + S_between_min_max + '" onchange="set_display_custom_text_cond1_inside_range_text(this)"></input></td>' +
          '<td rowspan=2><input type="text" id="input_condition_outside_range_text" placeholder="' + S_outside_min_max + '" onchange="set_display_custom_text_cond1_outside_range_text(this)"></input></td>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_max + '</td>' +
          '<td><input type="number" id="input_condition_range_max" onchange="set_display_custom_text_condition_range_max(this)"></input></td>' +
          '</tr>' +
          '</table>';
        
        var input_condition_range_min = document.getElementById('input_condition_range_min');
        var input_condition_range_max = document.getElementById('input_condition_range_max');
        var input_condition_inside_range_text = document.getElementById('input_condition_inside_range_text');
        var input_condition_outside_range_text = document.getElementById('input_condition_outside_range_text');
        
        input_condition_range_min.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.range_min;
        input_condition_range_max.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.range_max;
        input_condition_inside_range_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.inside_range;
        input_condition_outside_range_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.outside_range;
        break;
      
      case 2:
        display_condition_data_row.innerHTML =
          '<table style="border-style:none;">' +
          '<tr>' +
          '<th colspan=2>' + S_range + '</th>' +
          '<th>' + S_text + '</th>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_min + '</td>' +
          '<td><input type="number" id="input_condition_range_min" onchange="set_display_custom_text_condition_range_min(this)"></input></td>' +
          '<td rowspan=2>' +
          '<table style="border-style:none;">' +
          '<tr>' +
          '<td>' + S_less_min + '</td>' +
          '<td><input type="text" id="input_condition_below_range_text" placeholder="' + S_below_range + '" onchange="set_display_custom_text_cond2_below_range_text(this)"></input></td>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_min_max + '</td>' +
          '<td><input type="text" id="input_condition_inside_range_text" placeholder="' + S_inside_range + '" onchange="set_display_custom_text_cond2_inside_range_text(this)"></input></td>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_greater_max + '</td>' +
          '<td><input type="text" id="input_condition_above_range_text" placeholder="' + S_above_range + '" onchange="set_display_custom_text_cond2_above_range_text(this)"></input></td>' +
          '</tr>' +
          '</table>' +
          '</td>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_max + '</td>' +
          '<td><input type="number" id="input_condition_range_max" onchange="set_display_custom_text_condition_range_max(this)"></input></td>' +
          '</tr>' +
          '</table>';
        
        var input_condition_range_min = document.getElementById('input_condition_range_min');
        var input_condition_range_max = document.getElementById('input_condition_range_max');
        var input_condition_below_range_text = document.getElementById('input_condition_below_range_text');
        var input_condition_inside_range_text = document.getElementById('input_condition_inside_range_text');
        var input_condition_above_range_text = document.getElementById('input_condition_above_range_text');
        
        input_condition_range_min.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.range_min;
        input_condition_range_max.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.range_max;
        input_condition_below_range_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.below_range;
        input_condition_inside_range_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.inside_range;
        input_condition_above_range_text.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.above_range;
        break;
    }
  }
  
  function change_warning_mode(mode) {
    var warning = {};
    
    switch (mode) {
      case 0: //disabled
        warning = {
          mode: mode
        }
        break;
      
      case 1: //if exact value
      case 2: //if not exact value
        warning = {
          mode: mode,
          value: 0
        }
        break;
      
      case 3: //if inside range
      case 4: //if outside range
        warning = {
          mode: mode,
          range_min: 0,
          range_max: 0
        }
        break;
    }
    
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning = warning;
    
    show_warning_mode();
  }
  
  function create_graph_parameters() {
    var graph = {
      top: 1000,
      bottom: 0,
      rate: 150
    };
    
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph = graph;
    
    show_graph_parameters();
  }
  
  function show_warning_mode() {
    var warning_header_row = document.getElementById('warning_header_row');
    var warning_data_row = document.getElementById('warning_data_row');
    var mode = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.mode;
    
    switch (mode) {
      case 0:
        warning_header_row.innerHTML = '<th>Mode</th>';
        
        warning_data_row.innerHTML =
          '<td>' +
          '<select id="select_warning_mode" onchange="change_warning_mode(this.selectedIndex)">' +
          '<option selected>' + S_disabled +
          '<option>' + S_if_exact_value +
          '<option>' + S_if_not_exact_value +
          '<option>' + S_if_inside_range +
          '<option>' + S_if_outside_range +
          '</select>' +
          '</td>';
        
        break;
      
      case 1:
      case 2:
        var selected1 = (mode === 1) ? ('<option selected>' + S_if_exact_value) : ('<option>' + S_if_exact_value)
        var selected2 = (mode === 2) ? ('<option selected>' + S_if_not_exact_value) : ('<option>' + S_if_not_exact_value)
        
        warning_header_row.innerHTML =
          '<th>' + S_mode + '</th>' +
          '<th>' + S_value + '</th>';
        
        warning_data_row.innerHTML =
          '<td>' +
          '<select id="select_warning_mode" onchange="change_warning_mode(this.selectedIndex)">' +
          '<option>' + S_disabled +
          selected1 +
          selected2 +
          '<option>' + S_if_inside_range +
          '<option>' + S_if_outside_range +
          '</select>' +
          '</td>' +
          '<td>' +
          '<input type="number" id="input_warning_value" onchange="set_warning_value(this)"></input>' +
          '</td>' ;
        
        var input_warning_value = document.getElementById('input_warning_value');
        
        input_warning_value.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.value;
        break;
      
      case 3:
      case 4:
        var selected3 = (mode === 3) ? ('<option selected>' + S_if_inside_range) : ('<option>' + S_if_inside_range)
        var selected4 = (mode === 4) ? ('<option selected>' + S_if_outside_range) : ('<option>' + S_if_outside_range)
        
        warning_header_row.innerHTML =
          '<th>' + S_mode + '</th>' +
          '<th rowspan=2>' +
          '<table style="border-style:none;">' +
          '<tr>' +
          '<th colspan=2>' + S_range + '</th>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_min + '</td>' +
          '<td><input type="number" id="input_warning_range_min" onchange="set_warning_range_min(this)"></input></td>' +
          '</tr>' +
          '<tr>' +
          '<td>' + S_max + '</td>' +
          '<td><input type="number" id="input_warning_range_max" onchange="set_warning_range_max(this)"></input></td>' +
          '</tr>' +
          '</table>' +
          '</th>';
        
        warning_data_row.innerHTML =
          '<td>' +
          '<select id="select_warning_mode" onchange="change_warning_mode(this.selectedIndex)">' +
          '<option>' + S_disabled +
          '<option>' + S_if_exact_value +
          '<option>' + S_if_not_exact_value +
          selected3 +
          selected4 +
          '</select>' +
          '</td>';
        
        var input_warning_range_min = document.getElementById('input_warning_range_min');
        var input_warning_range_max = document.getElementById('input_warning_range_max');
        
        input_warning_range_min.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.range_min;
        input_warning_range_max.value = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.range_max;
        break;
    }
  }
  
  function show_graph_parameters() {
    var top = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph.top;
    var bottom = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph.bottom;
    var rate = page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].graph.rate;
    
    var input_graph_top = document.getElementById('input_graph_top');
    var input_graph_bottom = document.getElementById('input_graph_bottom');
    var input_graph_rate = document.getElementById('input_graph_rate');
    
    input_graph_top.value = top;
    input_graph_bottom.value = bottom;
    input_graph_rate.value = rate;
  }
  
  //Save the page's title from the input box
  function set_page_title(obj) {
    var input_page_title = document.getElementById('input_page_title');
    var select_page = document.getElementById('select_page');
    
    var title = obj.value;
    
    if (title.length > 15) {
      title = title.substring(0, 15);
      obj.value = title;
    }
    
    page_array[select_page.selectedIndex].title = title;
  }
  
  function enable_aligned_units(state) {
    var select_page = document.getElementById('select_page');
    
    if (state) {
      page_array[select_page.selectedIndex].settings |= (1 << 0);
    }
    else {
      page_array[select_page.selectedIndex].settings &= ~(1 << 0);
    }
  }
  
  function enable_bar_at_bottom(state) {
    var select_page = document.getElementById('select_page');
    
    if (state) {
      page_array[select_page.selectedIndex].settings |= (1 << 1);
    }
    else {
      page_array[select_page.selectedIndex].settings &= ~(1 << 1);
    }
  }
  
  //Save the parameter's name from the input box
  function set_parameter_name(obj) {
    var input_parameter_name = document.getElementById('input_parameter_name');
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var name = obj.value;
    
    if (name.length > 15) {
      name = name.substring(0, 15);
      obj.value = name;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].name = name;
  }
  
  //Save the parameter's units from the input box
  function set_parameter_units(obj) {
    var input_parameter_units = document.getElementById('input_parameter_units');
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var units = obj.value;
    
    if (units.length > 15) {
      units = units.substring(0, 15);
      obj.value = units;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].units = units;
  }
  
  function set_parameter_kwp_block(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.block = obj.selectedIndex + 1;
  }
  
  function set_parameter_kwp_index(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.index = obj.selectedIndex + 1;
  }
  
  function set_parameter_uds_identifier(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var identifier = parseInt(obj.value);
    
    if (isNaN(identifier)) {
      identifier = 0;
      obj.value = 0;
    }
    else {
      if (identifier < 0) {
        identifier = 0;
        obj.value = 0;
      }
      
      if (identifier > 65535) {
        identifier = 65535;
        obj.value = 65535;
      }
      
      identifier = Math.trunc(identifier);
      obj.value = identifier;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.identifier = identifier;
  }
  
  function set_parameter_uds_endianness(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.endianness = obj.selectedIndex;
  }
  
  function set_parameter_uds_index(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
        
    var index = parseInt(obj.value);
    
    if (isNaN(index)) {
      index = 0;
      obj.value = 0;
    }
    else {
      if (index < 0) {
        index = 0;
        obj.value = 0;
      }
      
      if (index > 65535) {
        index = 65535;
        obj.value = 65535;
      }
      
      index = Math.trunc(index);
      obj.value = index;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.index = index;
  }
  
  function set_parameter_uds_size(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var size = parseInt(obj.value);
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.size = size;
  }
  
  function set_parameter_uds_sign(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.sign = obj.selectedIndex;
  }
  
  function set_parameter_uds_factor(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
        
    var factor = parseInt(obj.value);
    
    if (isNaN(factor)) {
      factor = 0;
      obj.value = 0;
    }
    else {
      if (factor < 0) {
        factor = 0;
        obj.value = 0;
      }
      
      if (factor > 65535) {
        factor = 65535;
        obj.value = 65535;
      }
      
      factor = Math.trunc(factor);
      obj.value = factor;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.factor = factor;
  }
  
  function set_parameter_uds_divisor(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var divisor = parseInt(obj.value);
    
    if (isNaN(divisor)) {
      divisor = 0;
      obj.value = 0;
    }
    else {
      if (divisor < 0) {
        divisor = 0;
        obj.value = 0;
      }
      
      if (divisor > 65535) {
        divisor = 65535;
        obj.value = 65535;
      }
      
      divisor = Math.trunc(divisor);
      obj.value = divisor;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.divisor = divisor;
  }
  
  function set_parameter_uds_offset(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var offset = parseFloat(obj.value);
    if (isNaN(offset)) {
      offset = 0;
      obj.value = 0;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.offset = offset;
  }
  
  function set_parameter_display_forced(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var forced = ~~(obj.checked);
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.forced = forced;
  }
  
  function set_parameter_display_decimals(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var decimals = parseInt(obj.value);
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.decimals = decimals;
  }
  
  function set_parameter_display_map_offset(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var offset = parseFloat(obj.value);
    
    if (isNaN(offset)) {
      offset = 0;
      obj.value = 0;
    }
    else {
      obj.value = offset;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.offset = offset;
  }
  
  function set_parameter_display_map_in_min(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var in_min = parseFloat(obj.value);
    
    if (isNaN(in_min)) {
      in_min = 0;
      obj.value = 0;
    }
    else {
      obj.value = in_min;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.in_min = in_min;
  }
  
  function set_parameter_display_map_out_min(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var out_min = parseFloat(obj.value);
    
    if (isNaN(out_min)) {
      out_min = 0;
      obj.value = 0;
    }
    else {      
      obj.value = out_min;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.out_min = out_min;
  }
  
  function set_parameter_display_map_limit_min(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var limit_min = ~~(obj.checked);
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.limit_min = limit_min;
  }
  
  function set_parameter_display_map_in_max(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var in_max = parseFloat(obj.value);
    
    if (isNaN(in_max)) {
      in_max = 0;
      obj.value = 0;
    }
    else {
      obj.value = in_max;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.in_max = in_max;
  }
  
  function set_parameter_display_map_out_max(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var out_max = parseFloat(obj.value);
    
    if (isNaN(out_max)) {
      out_max = 0;
      obj.value = 0;
    }
    else {
      obj.value = out_max;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.out_max = out_max;
  }
  
  function set_parameter_display_map_limit_max(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var limit_max = ~~(obj.checked);
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.limit_max = limit_max;
  }
  
  function set_display_custom_text_cond0_value(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var value = parseInt(obj.value);
    
    if (isNaN(value)) {
      value = 0;
      obj.value = 0;
    }
    else {
      if (value < -32768) {
        value = -32768;
        obj.value = -32768;
      }
      
      if (value > 32767) {
        value = 32767;
        obj.value = 32767;
      }
      
      value = Math.trunc(value);
      obj.value = value;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.value = value;
  }
  
  function set_display_custom_text_cond0_if_value_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var if_value = obj.value;
    
    if (if_value.length > 15) {
      if_value = if_value.substring(0, 15);
      obj.value = if_value;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.if_value = if_value;
  }
  
  function set_display_custom_text_cond0_if_not_value_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var if_not_value = obj.value;
    
    if (if_not_value.length > 15) {
      if_not_value = if_not_value.substring(0, 15);
      obj.value = if_not_value;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.if_not_value = if_not_value;
  }
  
  function set_display_custom_text_condition_range_min(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var range_min = parseInt(obj.value);
    
    if (isNaN(range_min)) {
      range_min = 0;
      obj.value = 0;
    }
    else {
      if (range_min < -32768) {
        range_min = -32768;
        obj.value = -32768;
      }
      
      if (range_min > 32767) {
        range_min = 32767;
        obj.value = 32767;
      }
      
      range_min = Math.trunc(range_min);
      obj.value = range_min;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.range_min = range_min;
  }
  
  function set_display_custom_text_condition_range_max(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var range_max = parseInt(obj.value);
    
    if (isNaN(range_max)) {
      range_max = 0;
      obj.value = 0;
    }
    else {
      if (range_max < -32768) {
        range_max = -32768;
        obj.value = -32768;
      }
      
      if (range_max > 32767) {
        range_max = 32767;
        obj.value = 32767;
      }
      
      range_max = Math.trunc(range_max);
      obj.value = range_max;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.range_max = range_max;
  }
  
  function set_display_custom_text_cond1_inside_range_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var inside_range = obj.value;
    
    if (inside_range.length > 15) {
      inside_range = inside_range.substring(0, 15);
      obj.value = inside_range;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.inside_range = inside_range;
  }
  
  function set_display_custom_text_cond1_outside_range_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var outside_range = obj.value;
    
    if (outside_range.length > 15) {
      outside_range = outside_range.substring(0, 15);
      obj.value = outside_range;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.outside_range = outside_range;
  }
  
  function set_display_custom_text_cond2_below_range_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var below_range = obj.value;
    
    if (below_range.length > 15) {
      below_range = below_range.substring(0, 15);
      obj.value = below_range;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.below_range = below_range;
  }
  
  function set_display_custom_text_cond2_inside_range_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var inside_range = obj.value;
    
    if (inside_range.length > 15) {
      inside_range = inside_range.substring(0, 15);
      obj.value = inside_range;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.inside_range = inside_range;
  }
  
  function set_display_custom_text_cond2_above_range_text(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var above_range = obj.value;
    
    if (above_range.length > 15) {
      above_range = above_range.substring(0, 15);
      obj.value = above_range;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].display.condition.above_range = above_range;
  }
  
  function set_warning_value(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var value = parseInt(obj.value);
    
    if (isNaN(value)) {
      value = 0;
      obj.value = 0;
    }
    else {
      if (value < -32768) {
        value = -32768;
        obj.value = -32768;
      }
      
      if (value > 32767) {
        value = 32767;
        obj.value = 32767;
      }
      
      value = Math.trunc(value);
      obj.value = value;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.value = value;
  }
  
  function set_warning_range_min(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var range_min = parseInt(obj.value);
    
    if (isNaN(range_min)) {
      range_min = 0;
      obj.value = 0;
    }
    else {
      if (range_min < -32768) {
        range_min = -32768;
        obj.value = -32768;
      }
      
      if (range_min > 32767) {
        range_min = 32767;
        obj.value = 32767;
      }
      
      range_min = Math.trunc(range_min);
      obj.value = range_min;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.range_min = range_min;
  }
  
  function set_warning_range_max(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    var range_max = parseInt(obj.value);
    
    if (isNaN(range_max)) {
      range_max = 0;
      obj.value = 0;
    }
    else {
      if (range_max < -32768) {
        range_max = -32768;
        obj.value = -32768;
      }
      
      if (range_max > 32767) {
        range_max = 32767;
        obj.value = 32767;
      }
      
      range_max = Math.trunc(range_max);
      obj.value = range_max;
    }
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].warning.range_max = range_max;
  }
  
  function set_parameter_wifi_device_measurement(obj) {
    var select_page = document.getElementById('select_page');
    var select_parameter = document.getElementById('select_parameter');
    
    page_array[select_page.selectedIndex].parameters[select_parameter.selectedIndex].source.measurement = obj.selectedIndex;
  }
  
  var load_file = function(event) {
    var reader = new FileReader();
    
    reader.onload = function() {
      read_file(reader);
    };
    
    reader.readAsArrayBuffer(event.target.files[0]);
  }
  
  function read_file(reader) {
    var decoder = new TextDecoder('iso-8859-2');
    
    //Store the read data in an array
    var bytes_read = reader.result.byteLength;
    var buffer = new ArrayBuffer(bytes_read);
    buffer = reader.result;
    
    //Convert the read data to uint8
    var file_buffer = new Uint8Array(buffer);
    
    //Validate the file format
    var signature1 = (file_buffer[0] << 8) | file_buffer[1];
    var signature2 = (file_buffer[bytes_read - 2] << 8) | file_buffer[bytes_read - 1];
    
    if (!(signature1 === 0x55AA && signature2 === 0x55AA)) {
      alert(S_invalid_format);
      return;
    }
    
    var config_version = (file_buffer[3] << 8) | file_buffer[2];
    if (config_version != 0x0302) {
      alert(S_update_newer_version);
      
      var current_location = window.location.href;
      if (!current_location.endsWith('/'))
      {
        current_location += '/';
      }
      
      window.location.assign(current_location + 'config_updater/');
      return;
    }
    
    var global_settings_start = 4;
    var global_settings_end = global_settings_start + 4;
    var global_settings_array = file_buffer.slice(global_settings_start, global_settings_end);
    var global_settings = (new Uint32Array(global_settings_array.buffer))[0];
    
    setting_control_scheme = !!(global_settings & (1 << 0));
    openhaldex_tool.enabled = !!(global_settings & (1 << 1));
    
    change_global_settings();
    
    var wifi_pass_start = global_settings_end;
    var wifi_pass_length = get_string_length(file_buffer, wifi_pass_start, 63);
    var wifi_pass_end = wifi_pass_start + wifi_pass_length;
    wifi_pass = decoder.decode(file_buffer.slice(wifi_pass_start, wifi_pass_end));
        
    //Check if the acceleration timer tool is enabled
    var acceleration_timer_tool_start = wifi_pass_end + 1;
    acceleration_timer_tool.enabled = file_buffer[acceleration_timer_tool_start];
    
    var acceleration_timer_tool_end = acceleration_timer_tool_start + 1;
    if (acceleration_timer_tool.enabled) {
      var acceleration_timer_tool_protocol_start = acceleration_timer_tool_end;
      acceleration_timer_tool.protocol = file_buffer[acceleration_timer_tool_protocol_start];
      
      var acceleration_timer_tool_module_start = acceleration_timer_tool_protocol_start + 1;
      acceleration_timer_tool.module = file_buffer[acceleration_timer_tool_module_start];
      
      switch (acceleration_timer_tool.protocol) {
        case 0:
          var acceleration_timer_tool_block_start = acceleration_timer_tool_module_start + 1;
          acceleration_timer_tool.block = file_buffer[acceleration_timer_tool_block_start];
          
          var acceleration_timer_tool_index_start = acceleration_timer_tool_block_start + 1;
          acceleration_timer_tool.index = file_buffer[acceleration_timer_tool_index_start];
          
          acceleration_timer_tool_end = acceleration_timer_tool_index_start + 1;
          break;
        
        case 1:
          var acceleration_timer_tool_identifier_array_start = acceleration_timer_tool_module_start + 1;
          var acceleration_timer_tool_identifier_array_end = acceleration_timer_tool_identifier_array_start + 2;
          var acceleration_timer_tool_identifier_array = file_buffer.slice(acceleration_timer_tool_identifier_array_start, acceleration_timer_tool_identifier_array_end);
          var acceleration_timer_tool_identifier = (new Uint16Array(acceleration_timer_tool_identifier_array.buffer))[0];
          acceleration_timer_tool.identifier = acceleration_timer_tool_identifier;
                      
          var acceleration_timer_tool_endianness_start = acceleration_timer_tool_identifier_array_end;
          var acceleration_timer_tool_endianness = file_buffer[acceleration_timer_tool_endianness_start];
          acceleration_timer_tool.endianness = acceleration_timer_tool_endianness;
          
          var acceleration_timer_tool_size_start = acceleration_timer_tool_endianness_start + 1;
          var acceleration_timer_tool_size = file_buffer[acceleration_timer_tool_size_start];
          acceleration_timer_tool.size = acceleration_timer_tool_size;
          
          var acceleration_timer_tool_sign_start = acceleration_timer_tool_size_start + 1;
          var acceleration_timer_tool_sign = file_buffer[acceleration_timer_tool_sign_start];
          acceleration_timer_tool.sign = acceleration_timer_tool_sign;
          
          var acceleration_timer_tool_factor_array_start = acceleration_timer_tool_sign_start + 1;
          var acceleration_timer_tool_factor_array_end = acceleration_timer_tool_factor_array_start + 2;
          var acceleration_timer_tool_factor_array = file_buffer.slice(acceleration_timer_tool_factor_array_start, acceleration_timer_tool_factor_array_end);
          var acceleration_timer_tool_factor = (new Uint16Array(acceleration_timer_tool_factor_array.buffer))[0];
          acceleration_timer_tool.factor = acceleration_timer_tool_factor;
          
          var acceleration_timer_tool_divisor_array_start = acceleration_timer_tool_factor_array_end;
          var acceleration_timer_tool_divisor_array_end = acceleration_timer_tool_divisor_array_start + 2;
          var acceleration_timer_tool_divisor_array = file_buffer.slice(acceleration_timer_tool_divisor_array_start, acceleration_timer_tool_divisor_array_end);
          var acceleration_timer_tool_divisor = (new Uint16Array(acceleration_timer_tool_divisor_array.buffer))[0];
          acceleration_timer_tool.divisor = acceleration_timer_tool_divisor;
          
          var acceleration_timer_tool_offset_array_start = acceleration_timer_tool_divisor_array_end;
          var acceleration_timer_tool_offset_array_end = acceleration_timer_tool_offset_array_start + 4;
          var acceleration_timer_tool_offset_array = file_buffer.slice(acceleration_timer_tool_offset_array_start, acceleration_timer_tool_offset_array_end);
          var acceleration_timer_tool_offset = (new Float32Array(acceleration_timer_tool_offset_array.buffer))[0];
          acceleration_timer_tool_offset = acceleration_timer_tool_offset.toFixed(3);
          acceleration_timer_tool.offset = acceleration_timer_tool_offset;
          
          acceleration_timer_tool_end = acceleration_timer_tool_offset_array_end;
          break;
      }
    }
    
    //Check if the oil level checker tool is enabled
    var oil_level_checker_tool_start = acceleration_timer_tool_end;
    oil_level_checker_tool.enabled = file_buffer[oil_level_checker_tool_start];
    
    var oil_level_checker_tool_end = oil_level_checker_tool_start + 1;
    if (oil_level_checker_tool.enabled) {
      var oil_level_checker_tool_min_array_start = oil_level_checker_tool_end;
      var oil_level_checker_tool_min_array_end = oil_level_checker_tool_min_array_start + 4;
      var oil_level_checker_tool_min_array = file_buffer.slice(oil_level_checker_tool_min_array_start, oil_level_checker_tool_min_array_end);
      var oil_level_checker_tool_min = (new Float32Array(oil_level_checker_tool_min_array.buffer))[0];
      oil_level_checker_tool_min = oil_level_checker_tool_min.toFixed(3);
      oil_level_checker_tool.min = oil_level_checker_tool_min;
      
      var oil_level_checker_tool_max_array_start = oil_level_checker_tool_min_array_end;
      var oil_level_checker_tool_max_array_end = oil_level_checker_tool_max_array_start + 4;
      var oil_level_checker_tool_max_array = file_buffer.slice(oil_level_checker_tool_max_array_start, oil_level_checker_tool_max_array_end);
      var oil_level_checker_tool_max = (new Float32Array(oil_level_checker_tool_max_array.buffer))[0];
      oil_level_checker_tool_max = oil_level_checker_tool_max.toFixed(3);
      oil_level_checker_tool.max = oil_level_checker_tool_max;
      
      var oil_level_checker_tool_protocol_start = oil_level_checker_tool_max_array_end;
      oil_level_checker_tool.protocol = file_buffer[oil_level_checker_tool_protocol_start];
      
      var oil_level_checker_tool_module_start = oil_level_checker_tool_protocol_start + 1;
      oil_level_checker_tool.module = file_buffer[oil_level_checker_tool_module_start];
      
      switch (oil_level_checker_tool.protocol) {
        case 0:
          //Oil level
          var oil_level_checker_tool_block_start = oil_level_checker_tool_module_start + 1;
          oil_level_checker_tool.block = file_buffer[oil_level_checker_tool_block_start];
          
          var oil_level_checker_tool_index_start = oil_level_checker_tool_block_start + 1;
          oil_level_checker_tool.index = file_buffer[oil_level_checker_tool_index_start];
          
          //Oil temp
          var oil_level_checker_tool_block_temp_start = oil_level_checker_tool_index_start + 1;
          oil_level_checker_tool.block_temp = file_buffer[oil_level_checker_tool_block_temp_start];
          
          var oil_level_checker_tool_index_temp_start = oil_level_checker_tool_block_temp_start + 1;
          oil_level_checker_tool.index_temp = file_buffer[oil_level_checker_tool_index_temp_start];
          
          oil_level_checker_tool_end = oil_level_checker_tool_index_temp_start + 1;
          break;
        
        case 1:
          //Oil level
          var oil_level_checker_tool_identifier_array_start = oil_level_checker_tool_module_start + 1;
          var oil_level_checker_tool_identifier_array_end = oil_level_checker_tool_identifier_array_start + 2;
          var oil_level_checker_tool_identifier_array = file_buffer.slice(oil_level_checker_tool_identifier_array_start, oil_level_checker_tool_identifier_array_end);
          var oil_level_checker_tool_identifier = (new Uint16Array(oil_level_checker_tool_identifier_array.buffer))[0];
          oil_level_checker_tool.identifier = oil_level_checker_tool_identifier;
                      
          var oil_level_checker_tool_endianness_start = oil_level_checker_tool_identifier_array_end;
          var oil_level_checker_tool_endianness = file_buffer[oil_level_checker_tool_endianness_start];
          oil_level_checker_tool.endianness = oil_level_checker_tool_endianness;
          
          var oil_level_checker_tool_size_start = oil_level_checker_tool_endianness_start + 1;
          var oil_level_checker_tool_size = file_buffer[oil_level_checker_tool_size_start];
          oil_level_checker_tool.size = oil_level_checker_tool_size;
          
          var oil_level_checker_tool_sign_start = oil_level_checker_tool_size_start + 1;
          var oil_level_checker_tool_sign = file_buffer[oil_level_checker_tool_sign_start];
          oil_level_checker_tool.sign = oil_level_checker_tool_sign;
          
          var oil_level_checker_tool_factor_array_start = oil_level_checker_tool_sign_start + 1;
          var oil_level_checker_tool_factor_array_end = oil_level_checker_tool_factor_array_start + 2;
          var oil_level_checker_tool_factor_array = file_buffer.slice(oil_level_checker_tool_factor_array_start, oil_level_checker_tool_factor_array_end);
          var oil_level_checker_tool_factor = (new Uint16Array(oil_level_checker_tool_factor_array.buffer))[0];
          oil_level_checker_tool.factor = oil_level_checker_tool_factor;
          
          var oil_level_checker_tool_divisor_array_start = oil_level_checker_tool_factor_array_end;
          var oil_level_checker_tool_divisor_array_end = oil_level_checker_tool_divisor_array_start + 2;
          var oil_level_checker_tool_divisor_array = file_buffer.slice(oil_level_checker_tool_divisor_array_start, oil_level_checker_tool_divisor_array_end);
          var oil_level_checker_tool_divisor = (new Uint16Array(oil_level_checker_tool_divisor_array.buffer))[0];
          oil_level_checker_tool.divisor = oil_level_checker_tool_divisor;
          
          var oil_level_checker_tool_offset_array_start = oil_level_checker_tool_divisor_array_end;
          var oil_level_checker_tool_offset_array_end = oil_level_checker_tool_offset_array_start + 4;
          var oil_level_checker_tool_offset_array = file_buffer.slice(oil_level_checker_tool_offset_array_start, oil_level_checker_tool_offset_array_end);
          var oil_level_checker_tool_offset = (new Float32Array(oil_level_checker_tool_offset_array.buffer))[0];
          oil_level_checker_tool_offset = oil_level_checker_tool_offset.toFixed(3);
          oil_level_checker_tool.offset = oil_level_checker_tool_offset;
          
          //Oil temp
          var oil_level_checker_tool_identifier_temp_array_start = oil_level_checker_tool_offset_array_end;
          var oil_level_checker_tool_identifier_temp_array_end = oil_level_checker_tool_identifier_temp_array_start + 2;
          var oil_level_checker_tool_identifier_temp_array = file_buffer.slice(oil_level_checker_tool_identifier_temp_array_start, oil_level_checker_tool_identifier_temp_array_end);
          var oil_level_checker_tool_identifier_temp = (new Uint16Array(oil_level_checker_tool_identifier_temp_array.buffer))[0];
          oil_level_checker_tool.identifier_temp = oil_level_checker_tool_identifier_temp;
                      
          var oil_level_checker_tool_endianness_temp_start = oil_level_checker_tool_identifier_temp_array_end;
          var oil_level_checker_tool_endianness_temp = file_buffer[oil_level_checker_tool_endianness_temp_start];
          oil_level_checker_tool.endianness_temp = oil_level_checker_tool_endianness_temp;
          
          var oil_level_checker_tool_size_temp_start = oil_level_checker_tool_endianness_temp_start + 1;
          var oil_level_checker_tool_size_temp = file_buffer[oil_level_checker_tool_size_temp_start];
          oil_level_checker_tool.size_temp = oil_level_checker_tool_size_temp;
          
          var oil_level_checker_tool_sign_temp_start = oil_level_checker_tool_size_temp_start + 1;
          var oil_level_checker_tool_sign_temp = file_buffer[oil_level_checker_tool_sign_temp_start];
          oil_level_checker_tool.sign_temp = oil_level_checker_tool_sign_temp;
          
          var oil_level_checker_tool_factor_temp_array_start = oil_level_checker_tool_sign_temp_start + 1;
          var oil_level_checker_tool_factor_temp_array_end = oil_level_checker_tool_factor_temp_array_start + 2;
          var oil_level_checker_tool_factor_temp_array = file_buffer.slice(oil_level_checker_tool_factor_temp_array_start, oil_level_checker_tool_factor_temp_array_end);
          var oil_level_checker_tool_factor_temp = (new Uint16Array(oil_level_checker_tool_factor_temp_array.buffer))[0];
          oil_level_checker_tool.factor_temp = oil_level_checker_tool_factor_temp;
          
          var oil_level_checker_tool_divisor_temp_array_start = oil_level_checker_tool_factor_temp_array_end;
          var oil_level_checker_tool_divisor_temp_array_end = oil_level_checker_tool_divisor_temp_array_start + 2;
          var oil_level_checker_tool_divisor_temp_array = file_buffer.slice(oil_level_checker_tool_divisor_temp_array_start, oil_level_checker_tool_divisor_temp_array_end);
          var oil_level_checker_tool_divisor_temp = (new Uint16Array(oil_level_checker_tool_divisor_temp_array.buffer))[0];
          oil_level_checker_tool.divisor_temp = oil_level_checker_tool_divisor_temp;
          
          var oil_level_checker_tool_offset_temp_array_start = oil_level_checker_tool_divisor_temp_array_end;
          var oil_level_checker_tool_offset_temp_array_end = oil_level_checker_tool_offset_temp_array_start + 4;
          var oil_level_checker_tool_offset_temp_array = file_buffer.slice(oil_level_checker_tool_offset_temp_array_start, oil_level_checker_tool_offset_temp_array_end);
          var oil_level_checker_tool_offset_temp = (new Float32Array(oil_level_checker_tool_offset_temp_array.buffer))[0];
          oil_level_checker_tool_offset_temp = oil_level_checker_tool_offset_temp.toFixed(3);
          oil_level_checker_tool.offset_temp = oil_level_checker_tool_offset_temp;
          
          oil_level_checker_tool_end = oil_level_checker_tool_offset_temp_array_end;
          break;
      }
    }
    
    //Check if the engine mileage tool is enabled
    var engine_mileage_tool_start = oil_level_checker_tool_end;
    engine_mileage_tool.enabled = file_buffer[engine_mileage_tool_start];
    
    var engine_mileage_tool_end = engine_mileage_tool_start + 1;
    if (engine_mileage_tool.enabled) {
      var engine_mileage_tool_km_offset_array_start = engine_mileage_tool_end;
      var engine_mileage_tool_km_offset_array_end = engine_mileage_tool_km_offset_array_start + 4;
      var engine_mileage_tool_km_offset_array = file_buffer.slice(engine_mileage_tool_km_offset_array_start, engine_mileage_tool_km_offset_array_end);
      var engine_mileage_tool_km_offset = (new Uint32Array(engine_mileage_tool_km_offset_array.buffer))[0];
      engine_mileage_tool.km_offset = engine_mileage_tool_km_offset;
      
      var engine_mileage_tool_protocol_start = engine_mileage_tool_km_offset_array_end;
      engine_mileage_tool.protocol = file_buffer[engine_mileage_tool_protocol_start];
      
      var engine_mileage_tool_module_start = engine_mileage_tool_protocol_start + 1;
      engine_mileage_tool.module = file_buffer[engine_mileage_tool_module_start];
      
      switch (engine_mileage_tool.protocol) {
        case 0:
          var engine_mileage_tool_block_start = engine_mileage_tool_module_start + 1;
          engine_mileage_tool.block = file_buffer[engine_mileage_tool_block_start];
          
          var engine_mileage_tool_index_start = engine_mileage_tool_block_start + 1;
          engine_mileage_tool.index = file_buffer[engine_mileage_tool_index_start];
          
          engine_mileage_tool_end = engine_mileage_tool_index_start + 1;
          break;
        
        case 1:
          var engine_mileage_tool_identifier_array_start = engine_mileage_tool_module_start + 1;
          var engine_mileage_tool_identifier_array_end = engine_mileage_tool_identifier_array_start + 2;
          var engine_mileage_tool_identifier_array = file_buffer.slice(engine_mileage_tool_identifier_array_start, engine_mileage_tool_identifier_array_end);
          var engine_mileage_tool_identifier = (new Uint16Array(engine_mileage_tool_identifier_array.buffer))[0];
          engine_mileage_tool.identifier = engine_mileage_tool_identifier;
                      
          var engine_mileage_tool_endianness_start = engine_mileage_tool_identifier_array_end;
          var engine_mileage_tool_endianness = file_buffer[engine_mileage_tool_endianness_start];
          engine_mileage_tool.endianness = engine_mileage_tool_endianness;
          
          var engine_mileage_tool_size_start = engine_mileage_tool_endianness_start + 1;
          var engine_mileage_tool_size = file_buffer[engine_mileage_tool_size_start];
          engine_mileage_tool.size = engine_mileage_tool_size;
          
          var engine_mileage_tool_sign_start = engine_mileage_tool_size_start + 1;
          var engine_mileage_tool_sign = file_buffer[engine_mileage_tool_sign_start];
          engine_mileage_tool.sign = engine_mileage_tool_sign;
          
          var engine_mileage_tool_factor_array_start = engine_mileage_tool_sign_start + 1;
          var engine_mileage_tool_factor_array_end = engine_mileage_tool_factor_array_start + 2;
          var engine_mileage_tool_factor_array = file_buffer.slice(engine_mileage_tool_factor_array_start, engine_mileage_tool_factor_array_end);
          var engine_mileage_tool_factor = (new Uint16Array(engine_mileage_tool_factor_array.buffer))[0];
          engine_mileage_tool.factor = engine_mileage_tool_factor;
          
          var engine_mileage_tool_divisor_array_start = engine_mileage_tool_factor_array_end;
          var engine_mileage_tool_divisor_array_end = engine_mileage_tool_divisor_array_start + 2;
          var engine_mileage_tool_divisor_array = file_buffer.slice(engine_mileage_tool_divisor_array_start, engine_mileage_tool_divisor_array_end);
          var engine_mileage_tool_divisor = (new Uint16Array(engine_mileage_tool_divisor_array.buffer))[0];
          engine_mileage_tool.divisor = engine_mileage_tool_divisor;
          
          var engine_mileage_tool_offset_array_start = engine_mileage_tool_divisor_array_end;
          var engine_mileage_tool_offset_array_end = engine_mileage_tool_offset_array_start + 4;
          var engine_mileage_tool_offset_array = file_buffer.slice(engine_mileage_tool_offset_array_start, engine_mileage_tool_offset_array_end);
          var engine_mileage_tool_offset = (new Float32Array(engine_mileage_tool_offset_array.buffer))[0];
          engine_mileage_tool_offset = engine_mileage_tool_offset.toFixed(3);
          engine_mileage_tool.offset = engine_mileage_tool_offset;
          
          engine_mileage_tool_end = engine_mileage_tool_offset_array_end;
          break;
      }
    }
    
    change_tool(0);
    
    //Load the used KWP modules
    var used_kwp_devices_start = engine_mileage_tool_end;
    for (i = 0; i < used_kwp_devices.length; i++) {
      used_kwp_devices[i] = file_buffer[used_kwp_devices_start + i];
    }
    show_used_kwp_device();
    
    //Load the used UDS modules
    var used_uds_devices_start = used_kwp_devices_start + used_kwp_devices.length;
    for (i = 0; i < used_uds_devices.length; i++) {
      used_uds_devices[i] = file_buffer[used_uds_devices_start + i];
    }
    show_used_uds_device();
    
    //Clear the page array
    page_array = [];
    
    //Remove all page selection options
    var select_page = document.getElementById('select_page');
    for (i = (select_page.options.length - 1); i >= 0; i--) {
      select_page.remove(i);
    }
    
    //Determine the total amount of pages
    var number_of_pages_start = used_uds_devices_start + used_uds_devices.length;
    var number_of_pages = file_buffer[number_of_pages_start];
    
    //Store the starting offset of each page
    var page_offsets_buffer_start = number_of_pages_start + 1;
    var page_offsets_buffer_end = page_offsets_buffer_start + 4 * number_of_pages;
    var page_offsets_buffer = file_buffer.slice(page_offsets_buffer_start, page_offsets_buffer_end);
    var page_offsets = new Uint32Array(page_offsets_buffer.buffer);
    
    //Will contain each page's position in the file
    var page_starting_offsets = [];
    
    //Navigate the list of pages
    for (var pg = 0; pg < number_of_pages; pg++) {
      //Add a page selection option
      select_page.options.add(new Option(pg + 1));
      
      var page_settings_start = page_offsets[pg];
      var page_settings = file_buffer[page_settings_start];
      
      //Get the page title
      var title_start = page_settings_start + 1;
      var title_length = get_string_length(file_buffer, title_start, 15);
      var title_end = title_start + title_length;
      var title = decoder.decode(file_buffer.slice(title_start, title_end));
      
      //Page entry
      var page = {
        settings: page_settings,
        index: pg,
        title: title,
        parameters: []
      };
      
      //Add the page to the array
      page_array.push(page);
      
      //Get the number of parameters on this page
      var number_of_parameters_start = title_end + 1;
      var number_of_parameters = file_buffer[number_of_parameters_start];
      
      var parameter_offsets_buffer_start = number_of_parameters_start + 1;
      var parameter_offsets_buffer_end = parameter_offsets_buffer_start + 4 * number_of_parameters;
      var parameter_offsets_buffer = file_buffer.slice(parameter_offsets_buffer_start, parameter_offsets_buffer_end);
      var parameter_offsets = new Uint32Array(parameter_offsets_buffer.buffer);
      
      for (var par = 0; par < number_of_parameters; par++) {
        var parameter_settings_start = parameter_offsets[par];
        var parameter_settings = file_buffer[parameter_settings_start];
        
        //Get the parameter name
        var name_start = parameter_settings_start + 1;
        var name_length = get_string_length(file_buffer, name_start, 15);
        var name_end = name_start + name_length;
        var name = decoder.decode(file_buffer.slice(name_start, name_end));
        
        //Get the measurement units
        var units_start = name_end + 1;
        var units_length = get_string_length(file_buffer, units_start, 15);
        var units_end = units_start + units_length;
        var units = decoder.decode(file_buffer.slice(units_start, units_end));
                
        //Parameter entry
        const parameter = {
          settings: parameter_settings,
          index: par,
          name: name,
          units: units,
          source: {},
          display: {},
          warning: {},
          graph: {}
        };
        
        //Add the parameter to the array
        page_array[pg].parameters.push(parameter);
        
        var protocol_start = units_end + 1;
        var protocol = file_buffer[protocol_start];
        
        var module_start = protocol_start + 1;
        var module = file_buffer[module_start];
        
        var source_end;
        switch (protocol) {
          case 0: //KWP
            var block_start = module_start + 1;
            var block = file_buffer[block_start];
            
            var index_start = block_start + 1;
            var index = file_buffer[index_start];
            
            page_array[pg].parameters[par].source = {
              protocol: protocol,
              module: module,
              block: block,
              index: index
            };
            
            source_end = index_start + 1;
            break;
          
          case 1: //UDS
            var identifier_array_start = module_start + 1;
            var identifier_array_end = identifier_array_start + 2;
            var identifier_array = file_buffer.slice(identifier_array_start, identifier_array_end);
            var identifier = (new Uint16Array(identifier_array.buffer))[0];
                        
            var endianness_start = identifier_array_end;
            var endianness = file_buffer[endianness_start];
            
            var index_array_start = endianness_start + 1;
            var index_array_end = index_array_start + 2;
            var index_array = file_buffer.slice(index_array_start, index_array_end);
            var index = (new Uint16Array(index_array.buffer))[0];
            
            var size_start = index_array_end;
            var size = file_buffer[size_start];
            
            var sign_start = size_start + 1;
            var sign = file_buffer[sign_start];
            
            var factor_array_start = sign_start + 1;
            var factor_array_end = factor_array_start + 2;
            var factor_array = file_buffer.slice(factor_array_start, factor_array_end);
            var factor = (new Uint16Array(factor_array.buffer))[0];
            
            var divisor_array_start = factor_array_end;
            var divisor_array_end = divisor_array_start + 2;
            var divisor_array = file_buffer.slice(divisor_array_start, divisor_array_end);
            var divisor = (new Uint16Array(divisor_array.buffer))[0];
            
            var offset_array_start = divisor_array_end;
            var offset_array_end = offset_array_start + 4;
            var offset_array = file_buffer.slice(offset_array_start, offset_array_end);
            var offset = (new Float32Array(offset_array.buffer))[0];
            offset = offset.toFixed(3);
            
            page_array[pg].parameters[par].source = {
              protocol: protocol,
              module: module,
              identifier: identifier,
              endianness: endianness,
              index: index,
              size: size,
              sign: sign,
              factor: factor,
              divisor: divisor,
              offset: offset
            };
            
            source_end = offset_array_end;
            break;
            
          case 2: //Wi-Fi
            var device_start = module_start + 1;
            var device = file_buffer[device_start];
            
            var measurement_start = device_start + 1;
            var measurement = file_buffer[measurement_start];
            
            page_array[pg].parameters[par].source = {
              protocol: protocol,
              device: device,
              measurement: measurement
            };
            
            source_end = measurement_start + 1;
            break;
        }
        
        var display_mode_start = source_end;
        var display_mode = file_buffer[display_mode_start];
        
        var display_end;
        switch (display_mode) {
          case 0:
            var decimals_start = display_mode_start + 1;
            var decimals = file_buffer[decimals_start];
            
            var forced = ~~!!(decimals & (1 << 7));
            decimals &= ~(1 << 7);
            
            page_array[pg].parameters[par].display = {
              mode: display_mode,
              forced: forced,
              decimals: decimals
            };
            
            display_end = decimals_start + 1;
            break;
          
          case 1:
            var offset_array_start = display_mode_start + 1;
            var offset_array_end = offset_array_start + 4;
            var offset_array = file_buffer.slice(offset_array_start, offset_array_end);
            var offset = (new Float32Array(offset_array.buffer))[0];
            offset = offset.toFixed(3);
            
            var in_min_array_start = offset_array_end;
            var in_min_array_end = in_min_array_start + 4;
            var in_min_array = file_buffer.slice(in_min_array_start, in_min_array_end);
            var in_min = (new Float32Array(in_min_array.buffer))[0];
            
            var in_max_array_start = in_min_array_end;
            var in_max_array_end = in_max_array_start + 4;
            var in_max_array = file_buffer.slice(in_max_array_start, in_max_array_end);
            var in_max = (new Float32Array(in_max_array.buffer))[0];
            
            var out_min_array_start = in_max_array_end;
            var out_min_array_end = out_min_array_start + 4;
            var out_min_array = file_buffer.slice(out_min_array_start, out_min_array_end);
            var out_min = (new Float32Array(out_min_array.buffer))[0];
            
            var out_max_array_start = out_min_array_end;
            var out_max_array_end = out_max_array_start + 4;
            var out_max_array = file_buffer.slice(out_max_array_start, out_max_array_end);
            var out_max = (new Float32Array(out_max_array.buffer))[0];
            
            var decimals_start = out_max_array_end;
            var decimals = file_buffer[decimals_start];
            
            var limit_min = ~~!!(decimals & (1 << 6));
            var limit_max = ~~!!(decimals & (1 << 7));
            decimals &= ~((1 << 6) | (1 << 7));
            
            page_array[pg].parameters[par].display = {
              mode: display_mode,
              offset: offset,
              in_min: in_min,
              in_max: in_max,
              out_min: out_min,
              out_max: out_max,
              limit_min: limit_min,
              limit_max: limit_max,
              decimals: decimals
            };
            
            display_end = decimals_start + 1;
            break;
          
          case 2:
            page_array[pg].parameters[par].display = {
              mode: display_mode,
              condition: {}
            };
            
            var condition_type_start = display_mode_start + 1;
            var condition_type = file_buffer[condition_type_start];
            
            var condition_end;
            switch (condition_type) {
              case 0:
                var value_array_start = condition_type_start + 1;
                var value_array_end = value_array_start + 2;
                var value_array = file_buffer.slice(value_array_start, value_array_end);
                var value = (new Int16Array(value_array.buffer))[0];
                
                var if_value_start = value_array_end;
                var if_value_length = get_string_length(file_buffer, if_value_start, 15);
                var if_value_end = if_value_start + if_value_length;
                var if_value = decoder.decode(file_buffer.slice(if_value_start, if_value_end));
                
                var if_not_value_start = if_value_end + 1;
                var if_not_value_length = get_string_length(file_buffer, if_not_value_start, 15);
                var if_not_value_end = if_not_value_start + if_not_value_length;
                var if_not_value = decoder.decode(file_buffer.slice(if_not_value_start, if_not_value_end));
                
                page_array[pg].parameters[par].display.condition = {
                  type: condition_type,
                  value: value,
                  if_value: if_value,
                  if_not_value: if_not_value
                };
                
                condition_end = if_not_value_end + 1;
                break;
              
              case 1:
                var range_min_array_start = condition_type_start + 1;
                var range_min_array_end = range_min_array_start + 2;
                var range_min_array = file_buffer.slice(range_min_array_start, range_min_array_end);
                var range_min = (new Int16Array(range_min_array.buffer))[0];
                
                var range_max_array_start = range_min_array_end;
                var range_max_array_end = range_max_array_start + 2;
                var range_max_array = file_buffer.slice(range_max_array_start, range_max_array_end);
                var range_max = (new Int16Array(range_max_array.buffer))[0];
                
                var inside_range_start = range_max_array_end;
                var inside_range_length = get_string_length(file_buffer, inside_range_start, 15);
                var inside_range_end = inside_range_start + inside_range_length;
                var inside_range = decoder.decode(file_buffer.slice(inside_range_start, inside_range_end));
                
                var outside_range_start = inside_range_end + 1;
                var outside_range_length = get_string_length(file_buffer, outside_range_start, 15);
                var outside_range_end = outside_range_start + outside_range_length;
                var outside_range = decoder.decode(file_buffer.slice(outside_range_start, outside_range_end));
                
                page_array[pg].parameters[par].display.condition = {
                  type: condition_type,
                  range_min: range_min,
                  range_max: range_max,
                  inside_range: inside_range,
                  outside_range: outside_range
                };
                
                condition_end = outside_range_end + 1;
                break;
              
              case 2:
                var range_min_array_start = condition_type_start + 1;
                var range_min_array_end = range_min_array_start + 2;
                var range_min_array = file_buffer.slice(range_min_array_start, range_min_array_end);
                var range_min = (new Int16Array(range_min_array.buffer))[0];
                
                var range_max_array_start = range_min_array_end;
                var range_max_array_end = range_max_array_start + 2;
                var range_max_array = file_buffer.slice(range_max_array_start, range_max_array_end);
                var range_max = (new Int16Array(range_max_array.buffer))[0];
                
                var below_range_start = range_max_array_end;
                var below_range_length = get_string_length(file_buffer, below_range_start, 15);
                var below_range_end = below_range_start + below_range_length;
                var below_range = decoder.decode(file_buffer.slice(below_range_start, below_range_end));
                
                var inside_range_start = below_range_end + 1;
                var inside_range_length = get_string_length(file_buffer, inside_range_start, 15);
                var inside_range_end = inside_range_start + inside_range_length;
                var inside_range = decoder.decode(file_buffer.slice(inside_range_start, inside_range_end));
                
                var above_range_start = inside_range_end + 1;
                var above_range_length = get_string_length(file_buffer, above_range_start, 15);
                var above_range_end = above_range_start + above_range_length;
                var above_range = decoder.decode(file_buffer.slice(above_range_start, above_range_end));
                
                page_array[pg].parameters[par].display.condition = {
                  type: condition_type,
                  range_min: range_min,
                  range_max: range_max,
                  below_range: below_range,
                  inside_range: inside_range,
                  above_range: above_range
                };
                
                condition_end = above_range_end + 1;
                break;
            }
            
            display_end = condition_end;
            break;
        }
        
        var warning_mode_start = display_end;
        var warning_mode = file_buffer[warning_mode_start];
        
        var warning_end;
        switch (warning_mode) {
          case 0:
            page_array[pg].parameters[par].warning = {
              mode: warning_mode
            }
            
            warning_end = warning_mode_start + 1;
            break;
          
          case 1:
          case 2:
            var value_array_start = warning_mode_start + 1;
            var value_array_end = value_array_start + 2;
            var value_array = file_buffer.slice(value_array_start, value_array_end);
            var value = (new Int16Array(value_array.buffer))[0];
            
            page_array[pg].parameters[par].warning = {
              mode: warning_mode,
              value: value
            }
            
            warning_end = value_array_end;
            break;
          
          case 3:
          case 4:
            var range_min_array_start = warning_mode_start + 1;
            var range_min_array_end = range_min_array_start + 2;
            var range_min_array = file_buffer.slice(range_min_array_start, range_min_array_end);
            var range_min = (new Int16Array(range_min_array.buffer))[0];
            
            var range_max_array_start = range_min_array_end;
            var range_max_array_end = range_max_array_start + 2;
            var range_max_array = file_buffer.slice(range_max_array_start, range_max_array_end);
            var range_max = (new Int16Array(range_max_array.buffer))[0];
            
            page_array[pg].parameters[par].warning = {
              mode: warning_mode,
              range_min: range_min,
              range_max: range_max
            }
            
            warning_end = range_max_array_end;
            break;
        }
        
        var graph_top_array_start = warning_end;
        var graph_top_array_end = graph_top_array_start + 4;
        var graph_top_array = file_buffer.slice(graph_top_array_start, graph_top_array_end);
        var graph_top = (new Float32Array(graph_top_array.buffer))[0];
        graph_top = graph_top.toFixed(3);
        
        var graph_bottom_array_start = graph_top_array_end;
        var graph_bottom_array_end = graph_bottom_array_start + 4;
        var graph_bottom_array = file_buffer.slice(graph_bottom_array_start, graph_bottom_array_end);
        var graph_bottom = (new Float32Array(graph_bottom_array.buffer))[0];
        graph_bottom = graph_bottom.toFixed(3);
            
        var graph_rate_array_start = graph_bottom_array_end;
        var graph_rate_array_end = graph_rate_array_start + 2;
        var graph_rate_array = file_buffer.slice(graph_rate_array_start, graph_rate_array_end);
        var graph_rate = (new Int16Array(graph_rate_array.buffer))[0];
        
        page_array[pg].parameters[par].graph = {
          top: graph_top,
          bottom: graph_bottom,
          rate: graph_rate
        }
      }
    }
     
    change_to_page(0);
    change_to_parameter(0);
    
    alert(S_config_read_success)
  }
  
  function get_string_length(file_buffer, starting_offset, max_length) {
    var character_position = 0;
    while (true) {
      if (!file_buffer[starting_offset + character_position]) {
        break;
      }
      character_position++;
      
      if (character_position > max_length) {
        return -1;
      }
    }
    return character_position;
  }
  
  function download_file() {
    var file_buffer = [0x55, 0xAA, 0x02, 0x03];
    
    var global_settings = 0;
    global_settings |= ((setting_control_scheme & 1) << 0);
    global_settings |= ((openhaldex_tool.enabled & 1) << 1);
    file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint32Array([global_settings])).buffer)));
        
    var wifi_pass = "";
    file_buffer = file_buffer.concat(Array.from(encode8859(wifi_pass)), 0);
    
    file_buffer = file_buffer.concat(acceleration_timer_tool.enabled); //acceleration tool enable status
    if (acceleration_timer_tool.enabled) {
      if (!acceleration_timer_tool.module) {
        alert(S_acceleration_tool_error);
        return;
      }
      
      file_buffer = file_buffer.concat(acceleration_timer_tool.protocol); //speed protocol
      file_buffer = file_buffer.concat(acceleration_timer_tool.module); //speed module
      switch (acceleration_timer_tool.protocol) {
        case 0:
          file_buffer = file_buffer.concat(acceleration_timer_tool.block); //speed block
          file_buffer = file_buffer.concat(acceleration_timer_tool.index); //speed block index
          break;
        
        case 1:
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([acceleration_timer_tool.identifier])).buffer))); //speed identifier
          file_buffer = file_buffer.concat(acceleration_timer_tool.endianness); //speed endianness
          file_buffer = file_buffer.concat(acceleration_timer_tool.size); //speed byte size
          file_buffer = file_buffer.concat(acceleration_timer_tool.sign); //speed sign
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([acceleration_timer_tool.factor])).buffer))); //speed factor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([acceleration_timer_tool.divisor])).buffer))); //speed divisor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Float32Array([acceleration_timer_tool.offset])).buffer))); //speed offset
          break;
      }
    }
    
    file_buffer = file_buffer.concat(oil_level_checker_tool.enabled); //oil level tool enable status
    if (oil_level_checker_tool.enabled) {
      if (!oil_level_checker_tool.module) {
        alert(S_oil_level_tool_error);
        return;
      }
      
      if (oil_level_checker_tool.min > oil_level_checker_tool.max)
      {
        var x = oil_level_checker_tool.max;
        oil_level_checker_tool.max = oil_level_checker_tool.min;
        oil_level_checker_tool.min = x;
      }
      
      file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Float32Array([oil_level_checker_tool.min])).buffer))); //oil level min
      file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Float32Array([oil_level_checker_tool.max])).buffer))); //oil level max
      
      file_buffer = file_buffer.concat(oil_level_checker_tool.protocol); //oil level/temp protocol
      file_buffer = file_buffer.concat(oil_level_checker_tool.module); //oil level/temp module
      switch (oil_level_checker_tool.protocol) {
        case 0:
          file_buffer = file_buffer.concat(oil_level_checker_tool.block); //oil level block
          file_buffer = file_buffer.concat(oil_level_checker_tool.index); //oil level block index
          file_buffer = file_buffer.concat(oil_level_checker_tool.block_temp); //oil temp block
          file_buffer = file_buffer.concat(oil_level_checker_tool.index_temp); //oil temp block index
          break;
        
        case 1:
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([oil_level_checker_tool.identifier])).buffer))); //oil level identifier
          file_buffer = file_buffer.concat(oil_level_checker_tool.endianness); //oil level endianness
          file_buffer = file_buffer.concat(oil_level_checker_tool.size); //oil level byte size
          file_buffer = file_buffer.concat(oil_level_checker_tool.sign); //oil level sign
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([oil_level_checker_tool.factor])).buffer))); //oil level factor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([oil_level_checker_tool.divisor])).buffer))); //oil level divisor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Float32Array([oil_level_checker_tool.offset])).buffer))); //oil level offset
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([oil_level_checker_tool.identifier_temp])).buffer))); //oil temp identifier
          file_buffer = file_buffer.concat(oil_level_checker_tool.endianness_temp); //oil temp endianness
          file_buffer = file_buffer.concat(oil_level_checker_tool.size_temp); //oil temp byte size
          file_buffer = file_buffer.concat(oil_level_checker_tool.sign_temp); //oil temp sign
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([oil_level_checker_tool.factor_temp])).buffer))); //oil temp factor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([oil_level_checker_tool.divisor_temp])).buffer))); //oil temp divisor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Float32Array([oil_level_checker_tool.offset_temp])).buffer))); //oil temp offset
          break;
      }
    }
    
    file_buffer = file_buffer.concat(engine_mileage_tool.enabled); //engine mileage tool enable status
    if (engine_mileage_tool.enabled) {
      if (!engine_mileage_tool.module) {
        alert(S_mileage_tool_error);
        return;
      }
      
      file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint32Array([engine_mileage_tool.km_offset])).buffer))); //mileage km offset
      
      file_buffer = file_buffer.concat(engine_mileage_tool.protocol); //mileage protocol
      file_buffer = file_buffer.concat(engine_mileage_tool.module); //mileage module
      switch (engine_mileage_tool.protocol) {
        case 0:
          file_buffer = file_buffer.concat(engine_mileage_tool.block); //mileage block
          file_buffer = file_buffer.concat(engine_mileage_tool.index); //mileage block index
          break;
        
        case 1:
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([engine_mileage_tool.identifier])).buffer))); //mileage identifier
          file_buffer = file_buffer.concat(engine_mileage_tool.endianness); //mileage endianness
          file_buffer = file_buffer.concat(engine_mileage_tool.size); //mileage byte size
          file_buffer = file_buffer.concat(engine_mileage_tool.sign); //mileage sign
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([engine_mileage_tool.factor])).buffer))); //mileage factor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Uint16Array([engine_mileage_tool.divisor])).buffer))); //mileage divisor
          file_buffer = file_buffer.concat(Array.from(new Uint8Array((new Float32Array([engine_mileage_tool.offset])).buffer))); //mileage offset
          break;
      }
    }
    
    file_buffer = file_buffer.concat(used_kwp_devices); //KWP modules
    file_buffer = file_buffer.concat(used_uds_devices); //UDS modules
    file_buffer = file_buffer.concat(page_array.length); //number of pages
        
    var array_of_pages = [];
    var page_start_pointers = new Uint32Array(page_array.length);
    page_start_pointers[0] = file_buffer.length + 4 * page_array.length;
        
    for (var pg = 0; pg < page_array.length; pg++) {
      var page = page_array[pg];
      
      var page_buffer = [];
      
      var page_settings = page.settings;
      page_buffer = page_buffer.concat(Array.from(new Uint8Array([page_settings])));
      
      page_buffer = page_buffer.concat(Array.from(encode8859(page.title)), 0); //page title; null-terminated      
      page_buffer = page_buffer.concat(page.parameters.length); //number of parameters
      
      var array_of_parameters = [];
      var parameter_start_pointers = new Uint32Array(page.parameters.length);
      parameter_start_pointers[0] = page_start_pointers[pg] + page.title.length + 3 + 4 * page.parameters.length;
      
      for (var par = 0; par < page.parameters.length; par++) {
        parameter = page.parameters[par];
        
        var parameter_buffer = [];
        
        var parameter_settings = parameter.settings;
        parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array([parameter_settings])));
        
        parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.name)), 0); //parameter name; null-terminated
        parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.units)), 0); //parameter units; null-terminated
        
        parameter_buffer = parameter_buffer.concat(parameter.source.protocol); //source protocol
        
        switch (parameter.source.protocol) {
          case 0: //KWP
            parameter_buffer = parameter_buffer.concat(parameter.source.module); //source module
            var found = false;
            for (var i = 0; i < 5; i++) {
              if (parameter.source.module === used_kwp_devices[i]) {
                found = true;
              }
            }
            
            if (!found || !parameter.source.module) {
              alert(S_error_parameter + (par + 1) + S_on_page + (pg + 1) + S_has_invalid_KWP_source);
              return;
            }
            
            parameter_buffer = parameter_buffer.concat(parameter.source.block); //source block
            parameter_buffer = parameter_buffer.concat(parameter.source.index); //source block index
            break;
          
          case 1: //UDS
            parameter_buffer = parameter_buffer.concat(parameter.source.module); //source module
            var found = false;
            for (var i = 0; i < 5; i++) {
              if (parameter.source.module === used_uds_devices[i]) {
                found = true;
              }
            }
            
            if (!found || !parameter.source.module) {
              alert(S_error_parameter + (par + 1) + S_on_page + (pg + 1) + S_has_invalid_UDS_source);
              return;
            }
            
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Uint16Array([parameter.source.identifier])).buffer))); //identifier
            parameter_buffer = parameter_buffer.concat(parameter.source.endianness); //endianness
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Uint16Array([parameter.source.index])).buffer)));
            parameter_buffer = parameter_buffer.concat(parameter.source.size); //byte size
            parameter_buffer = parameter_buffer.concat(parameter.source.sign); //sign
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Uint16Array([parameter.source.factor])).buffer))); //factor
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Uint16Array([parameter.source.divisor])).buffer))); //divisor
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.source.offset])).buffer))); //offset
            break;
            
          case 2: //Wi-Fi
            parameter_buffer = parameter_buffer.concat(parameter.source.device); //source device
            parameter_buffer = parameter_buffer.concat(parameter.source.measurement); //source measurement
            break;
        }
        
        parameter_buffer = parameter_buffer.concat(parameter.display.mode);
        
        switch (parameter.display.mode) {
          case 0: //exact value
            var decimals = parameter.display.decimals;
            if (parameter.display.forced) decimals |= (1 << 7);
            parameter_buffer = parameter_buffer.concat(decimals); //decimals + forced flag
            break;
          
          case 1: //mapped value
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.display.offset])).buffer))); //offset
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.display.in_min])).buffer))); //in min
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.display.in_max])).buffer))); //in max
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.display.out_min])).buffer))); //out min
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.display.out_max])).buffer))); //out max
            
            var decimals = parameter.display.decimals;
            if (parameter.display.limit_min) decimals |= (1 << 6);
            if (parameter.display.limit_max) decimals |= (1 << 7);
            parameter_buffer = parameter_buffer.concat(decimals); //decimals + limit flags
            break;
          
          case 2: //custom text
            parameter_buffer = parameter_buffer.concat(parameter.display.condition.type);
             
            switch (parameter.display.condition.type) {
              case 0: //if/not value
                parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.display.condition.value])).buffer))); //value
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.if_value)), 0); //string if value; null-terminated
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.if_not_value)), 0); //string if not value; null-terminated
                break;
              
              case 1: //inside/outside range
                if (parameter.display.condition.range_min > parameter.display.condition.range_max)
                {
                  var x = parameter.display.condition.range_max;
                  parameter.display.condition.range_max = parameter.display.condition.range_min;
                  parameter.display.condition.range_min = x;
                }
                
                parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.display.condition.range_min])).buffer))); //range min
                parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.display.condition.range_max])).buffer))); //range max
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.inside_range)), 0); //string inside range; null-terminated
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.outside_range)), 0); //string outside range; null-terminated
                break;
              
              case 2: //below/inside/above range
                if (parameter.display.condition.range_min > parameter.display.condition.range_max)
                {
                  var x = parameter.display.condition.range_max;
                  parameter.display.condition.range_max = parameter.display.condition.range_min;
                  parameter.display.condition.range_min = x;
                }
                
                parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.display.condition.range_min])).buffer))); //range min
                parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.display.condition.range_max])).buffer))); //range max
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.below_range)), 0); //string below range; null-terminated
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.inside_range)), 0); //string inside range; null-terminated
                parameter_buffer = parameter_buffer.concat(Array.from(encode8859(parameter.display.condition.above_range)), 0); //string above range; null-terminated
                break;
            }
            break;
        }
        
        parameter_buffer = parameter_buffer.concat(parameter.warning.mode);
        
        switch (parameter.warning.mode) {
          case 1: //if exact value
          case 2: //if not exact value
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.warning.value])).buffer))); //value
            break;
          
          case 3: //if inside range
          case 4: //if outside range
            if (parameter.warning.range_min > parameter.warning.range_max)
            {
              var x = parameter.warning.range_max;
              parameter.warning.range_max = parameter.warning.range_min;
              parameter.warning.range_min = x;
            }
            
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.warning.range_min])).buffer))); //range min
            parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.warning.range_max])).buffer))); //range max
            break;
        }
        
        parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.graph.top])).buffer))); //graph top
        parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Float32Array([parameter.graph.bottom])).buffer))); //graph bottom
        parameter_buffer = parameter_buffer.concat(Array.from(new Uint8Array((new Int16Array([parameter.graph.rate])).buffer))); //graph rate
        
        //Parameter done; add it to the array
        array_of_parameters = array_of_parameters.concat(parameter_buffer);
        
        //Determine at what offset the parameter starts
        if (par !== (page.parameters.length - 1)) {
          parameter_start_pointers[par + 1] = parameter_start_pointers[par] + (Uint8Array.from(parameter_buffer)).length;
        }
      }
      
      //Page done; add the parameter lengths array to the start of the parameter array
      array_of_parameters = (Array.from(new Uint8Array(parameter_start_pointers.buffer))).concat(array_of_parameters);
      
      //Add the lengths+parameters array to the page buffer
      page_buffer = page_buffer.concat(array_of_parameters);
      
      //Add the page buffer to the page array
      array_of_pages = array_of_pages.concat(page_buffer);
      
      //Determine at what offset the page starts
      if (pg !== (page_array.length - 1)) {
        page_start_pointers[pg + 1] = page_start_pointers[pg] + (Uint8Array.from(page_buffer)).length;
      }
    }
    
    file_buffer = file_buffer.concat(Array.from(new Uint8Array(page_start_pointers.buffer)), array_of_pages);
    
    file_buffer = file_buffer.concat([0x55, 0xAA]);
    
    var typed_array = new Uint8Array(file_buffer);
    var blob = new Blob([typed_array]);
		saveAs(blob, "CANFIS_config.bin");
  }
</script>
